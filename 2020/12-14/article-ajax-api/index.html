<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo-loki.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,400,400italic,700,700italic%7CNoto+Sans+TC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"summer10920.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.17.0","exturl":false,"sidebar":{"position":"left","width":400,"display":"post","padding":20,"offset":20},"copycode":{"enable":true,"style":"mac"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Ajax 是「Asynchronous JavaScript and XML」（非同步的 JavaScript 與 XML 技術）的縮寫。我們知道靜態網頁都是一次性同步 (Synchronous HTTP Requests) 的請求與加載，每次要更新一個小部分都需要重新載入網頁。而透過 Ajax 能將網頁像電腦應用程式，不需要重新加載網頁情況下就能透過瀏覽器偷偷跟伺服器取得資料，並透過 DOM 技">
<meta property="og:type" content="article">
<meta property="og:title" content="[學習之路] Ajax 的相關領域技術與應用">
<meta property="og:url" content="http://summer10920.github.io/2020/12-14/article-ajax-api/">
<meta property="og:site_name" content="洛奇的邪惡組織手札">
<meta property="og:description" content="Ajax 是「Asynchronous JavaScript and XML」（非同步的 JavaScript 與 XML 技術）的縮寫。我們知道靜態網頁都是一次性同步 (Synchronous HTTP Requests) 的請求與加載，每次要更新一個小部分都需要重新載入網頁。而透過 Ajax 能將網頁像電腦應用程式，不需要重新加載網頁情況下就能透過瀏覽器偷偷跟伺服器取得資料，並透過 DOM 技">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.imgur.com/P8z88FS.jpg">
<meta property="article:published_time" content="2020-12-14T09:40:15.000Z">
<meta property="article:modified_time" content="2022-02-27T15:35:02.893Z">
<meta property="article:author" content="Loki Jiang">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="jQuery">
<meta property="article:tag" content="axios">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/P8z88FS.jpg">


<link rel="canonical" href="http://summer10920.github.io/2020/12-14/article-ajax-api/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"http://summer10920.github.io/2020/12-14/article-ajax-api/","path":"2020/12-14/article-ajax-api/","title":"[學習之路] Ajax 的相關領域技術與應用"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>[學習之路] Ajax 的相關領域技術與應用 | 洛奇的邪惡組織手札</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146423952-3"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-146423952-3","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>







<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&family=Roboto&display=swap" rel="stylesheet">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <canvas id="lokiBanner" width="1920" height="200"></canvas>
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">洛奇的邪惡組織手札</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">I am WebDeveloper!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜尋" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤<span class="badge">20</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類<span class="badge">17</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章<span class="badge">68</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          關於洛奇
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E7%A8%AE-Ajax-%E6%8A%80%E8%A1%93%E6%96%B9%E5%BC%8F"><span class="nav-number">1.</span> <span class="nav-text">四種 Ajax 技術方式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#JavaScript-%E7%9A%84-Ajax"><span class="nav-number">1.1.</span> <span class="nav-text">JavaScript 的 Ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8B%E7%B4%B9-XMLHttpRequest"><span class="nav-number">1.1.1.</span> <span class="nav-text">介紹 XMLHttpRequest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BD%9C%E6%A5%AD%E9%A0%86%E5%BA%8F%E8%AA%AA%E6%98%8E"><span class="nav-number">1.1.2.</span> <span class="nav-text">完整作業順序說明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jQuery-%E7%9A%84-Ajax"><span class="nav-number">1.2.</span> <span class="nav-text">jQuery 的 Ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8B%E7%B4%B9-ajax"><span class="nav-number">1.2.1.</span> <span class="nav-text">介紹 $.ajax</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8B%E7%B4%B9%E5%85%B6%E4%BB%96%E5%AF%AB%E6%B3%95"><span class="nav-number">1.2.2.</span> <span class="nav-text">介紹其他寫法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jqXHR-%E8%88%87-Deferred-%E9%81%9E%E5%BB%B6%E7%89%A9%E4%BB%B6"><span class="nav-number">1.2.3.</span> <span class="nav-text">jqXHR 與 Deferred 遞延物件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JavaScript-%E7%9A%84-fetch-API"><span class="nav-number">1.3.</span> <span class="nav-text">JavaScript 的 fetch API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E6%AC%A1%E4%BD%BF%E7%94%A8-Fetch-%EF%BC%88%E5%8F%96%E5%BE%97-JSON"><span class="nav-number">1.3.1.</span> <span class="nav-text">初次使用 Fetch （取得 JSON)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fetch-%E5%8F%AF%E7%94%A8%E8%A8%AD%E5%AE%9A"><span class="nav-number">1.3.2.</span> <span class="nav-text">Fetch 可用設定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%AF%84%E4%BE%8B"><span class="nav-number">1.3.3.</span> <span class="nav-text">使用範例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%9C%E6%AD%A2%E5%8F%96%E5%BE%97"><span class="nav-number">1.3.4.</span> <span class="nav-text">停止取得</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#axios-%E6%A1%86%E6%9E%B6%E7%9A%84-Ajax"><span class="nav-number">1.4.</span> <span class="nav-text">axios 框架的 Ajax</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E6%AC%A1%E4%BD%BF%E7%94%A8-Axios-API%EF%BC%88%E5%8F%96%E5%BE%97-JSON"><span class="nav-number">1.4.1.</span> <span class="nav-text">初次使用 Axios API（取得 JSON)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#axios-API-%E7%9A%84-config-%E5%8F%AF%E7%94%A8%E8%A8%AD%E5%AE%9A"><span class="nav-number">1.4.2.</span> <span class="nav-text">axios API 的 config 可用設定</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E8%88%AC%E5%8F%83%E6%95%B8"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">一般參數</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#promise-%E5%89%8D%E5%BE%8C%E8%99%95%E7%90%86"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">promise 前後處理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B6%B2%E5%9F%9F%E9%A9%97%E8%AD%89%E4%BB%A3%E7%90%86"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">網域驗證代理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Node-js"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">Node.js</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8B%E7%B4%B9%E6%89%80%E6%9C%89-axios-%E9%80%9F%E5%AF%AB%E6%B3%95"><span class="nav-number">1.4.3.</span> <span class="nav-text">介紹所有 axios 速寫法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AA%8D%E8%AD%98-Promise"><span class="nav-number">1.5.</span> <span class="nav-text">認識 Promise</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Promise-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E5%9E%8B"><span class="nav-number">1.5.1.</span> <span class="nav-text">Promise 基本原型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Promise-%E5%A4%9A%E9%A0%85%E7%9B%AE%E6%96%B9%E6%B3%95"><span class="nav-number">1.5.2.</span> <span class="nav-text">Promise 多項目方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#async-%E8%88%87-awit"><span class="nav-number">1.5.3.</span> <span class="nav-text">async 與 awit</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#API-%E4%B8%B2%E6%8E%A5"><span class="nav-number">2.</span> <span class="nav-text">API 串接</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RESTful"><span class="nav-number">2.1.</span> <span class="nav-text">RESTful</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenData-API"><span class="nav-number">2.2.</span> <span class="nav-text">OpenData API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%AC%E8%A9%A6%E6%96%B9%E5%BC%8F"><span class="nav-number">2.2.1.</span> <span class="nav-text">測試方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CORS-%E5%95%8F%E9%A1%8C%E8%88%87%E8%A7%A3%E6%B1%BA"><span class="nav-number">2.2.2.</span> <span class="nav-text">CORS 問題與解決</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%BA%E6%9C%8D%E5%99%A8%E9%96%8B%E6%94%BE-CORS"><span class="nav-number">2.2.3.</span> <span class="nav-text">伺服器開放 CORS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%8F%E9%81%8E-PHP-%E5%AD%98%E5%8F%96"><span class="nav-number">2.2.4.</span> <span class="nav-text">透過 PHP 存取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%8D%E8%B2%BB-OpenData-%E5%B9%B3%E5%8F%B0"><span class="nav-number">2.2.5.</span> <span class="nav-text">免費 OpenData 平台</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%83%E8%80%83%E6%96%87%E7%8D%BB"><span class="nav-number">3.</span> <span class="nav-text">參考文獻</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Loki Jiang"
      src="/images/loki_img.jpg">
  <p class="site-author-name" itemprop="name">Loki Jiang</p>
  <div class="site-description" itemprop="description">Time waits for no oneヽ(｀Д´)ﾉ</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/summer10920" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;summer10920" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:summer10920@gmail.com" title="E-Mail → mailto:summer10920@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://codepen.io/summer10920/pens/public?grid_type=list" title="CodePen → https:&#x2F;&#x2F;codepen.io&#x2F;summer10920&#x2F;pens&#x2F;public?grid_type&#x3D;list" rel="noopener me" target="_blank"><i class="fab fa-codepen fa-fw"></i>CodePen</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.youtube.com/c/LokiJiang/playlists" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;c&#x2F;LokiJiang&#x2F;playlists" rel="noopener me" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="回到頂端">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="http://demob17300.lokiwebs.com/" title="http:&#x2F;&#x2F;demob17300.lokiwebs.com&#x2F;" rel="noopener" target="_blank">DemoSite - 網頁設計乙術科</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://blog.lokiwebs.com/" title="http:&#x2F;&#x2F;blog.lokiwebs.com&#x2F;" rel="noopener" target="_blank">舊址(停更) - 札記 Blog</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://summer10920.github.io/2020/12-14/article-ajax-api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/loki_img.jpg">
      <meta itemprop="name" content="Loki Jiang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="洛奇的邪惡組織手札">
      <meta itemprop="description" content="Time waits for no oneヽ(｀Д´)ﾉ">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="[學習之路] Ajax 的相關領域技術與應用 | 洛奇的邪惡組織手札">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [學習之路] Ajax 的相關領域技術與應用
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間 ×2020-12-14 17:40:15" itemprop="dateCreated datePublished" datetime="2020-12-14T17:40:15+08:00">2020-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新於</span>
      <time title="修改時間 ×2022-02-27 23:35:02" itemprop="dateModified" datetime="2022-02-27T23:35:02+08:00">2022-02-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Zero-Road/" itemprop="url" rel="index"><span itemprop="name">Zero Road</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Zero-Road/Web-Fronted/" itemprop="url" rel="index"><span itemprop="name">Web Fronted</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數 ×</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數 ×</span>
      <span>10,143</span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>00:18:27</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>Ajax 是「Asynchronous JavaScript and XML」（非同步的 JavaScript 與 XML 技術）的縮寫。我們知道靜態網頁都是一次性同步 (Synchronous HTTP Requests) 的請求與加載，每次要更新一個小部分都需要重新載入網頁。而透過 Ajax 能將網頁像電腦應用程式，不需要重新加載網頁情況下就能透過瀏覽器偷偷跟伺服器取得資料，並透過 DOM 技術更新一小部分的畫面。伺服器對 Ajax 資料請求回應通常是以三種資料格式其中之一（HTML、XML、JSON）</p>
<span id="more"></span>

<p>Ajax 使用非同步 (Asynchronous HTTP Requests) 方式，讓瀏覽器跟伺服器互相傳遞資料（可能是 string, html code, xml, json 格式），緊接著需畫面翻新時，直接透過 DOM 完成畫面調整。因此 Ajax 是指多種技術來接力完成行為：</p>
<ul>
<li>HTML&#x2F;CSS: 先提供瀏覽器畫面讓使用者進行操作觸發</li>
<li>XML&#x2F;JSON&#x2F;String&#x2F;HTML: 伺服器採非同步方式將資料傳給瀏覽器之 JavaScript</li>
<li>DOM: 瀏覽器將 HTML 進行新增修改刪除行為</li>
<li>Asynchronous HTTP Requests: JavaScript 使用 HTTPRequest 物件 建立非同步的 HTTP 請求。</li>
</ul>
<p>同步與非同步的網頁請求最大差異是：</p>
<ul>
<li>同步 HTTP 請求會等待回應至整個網頁回來，因此網頁回應的時間內用戶不能做任何事情。每一次的網頁操作都是送出、等待、取得、顯示，才能做下一次操作。</li>
<li>非同步 HTTP 請求除了第一次的 HTTP&#x2F;CSS 加載完成後，之後的每次操作透過 JavaScript 建立的 Aja 引擎來提出非同步請求，因此每次 Ajax 的動作都是獨立且非同步（對伺服器來說兩者不一致）且需要透過 DOM 來補足內容差異性。網頁可持續其他作業不需要等待網頁回應而受中斷。</li>
</ul>
<h1 id="四種-Ajax-技術方式"><a href="#四種-Ajax-技術方式" class="headerlink" title="四種 Ajax 技術方式"></a>四種 Ajax 技術方式</h1><h2 id="JavaScript-的-Ajax"><a href="#JavaScript-的-Ajax" class="headerlink" title="JavaScript 的 Ajax"></a>JavaScript 的 Ajax</h2><p>JS 的 Ajax 應用需要透過標準物件 <code>XMLHttpRequest()</code> 來完成初始化。主要提供 GET 跟 POST 方法來取得或送出資訊。宣告完成後你隨時可以透過屬性 readyState 來檢查目前處理進度（提供代碼 0~4)。順序作業如下：</p>
<h3 id="介紹-XMLHttpRequest"><a href="#介紹-XMLHttpRequest" class="headerlink" title="介紹 XMLHttpRequest"></a>介紹 XMLHttpRequest</h3><p>雖然 XMLHttpRequest 這個物件的命名包含了 XML 與 HTTP 等字眼，但實際上 XMLHttpRequest 可用來接收任何類型的資料，不限於 XML 類型而已。正式運作 Ajax 你需要先用變數完成函式建構。</p>
<ul>
<li>XMLHttpRequest()：<br>建構式用來初始化一個 XMLHttpRequest 物件。必須在其他屬性或方法之前先宣告。</li>
<li>readyState：<br>能知道目前的 HTTP 請求狀態<table>
<thead>
<tr>
<th>value</th>
<th>state</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>UNSENT</td>
<td>客戶端已被建立，但 open() 方法尚未被呼叫。</td>
</tr>
<tr>
<td>1</td>
<td>OPEND</td>
<td>open() 方法已被呼叫。</td>
</tr>
<tr>
<td>2</td>
<td>HEADERS_RECEIVED</td>
<td>send() 方法已被呼叫，而且可取得 header 與狀態。</td>
</tr>
<tr>
<td>3</td>
<td>LOADING</td>
<td>回應資料下載中，此時 responseText 會擁有部分資料。</td>
</tr>
<tr>
<td>4</td>
<td>DONE</td>
<td>完成下載操作。</td>
</tr>
</tbody></table>
</li>
<li>responseText：<br>回傳一個 DOMString，其內容為請求之回應的文字內容。如請求失敗或尚未發送，則為 null。</li>
<li>responseXML：<br>回傳一個 Document，其內容為請求之回應內容所解析成的文件物件。如請求失敗或尚未發送，又或是無法解析成 XML、HTML，則為 null。</li>
<li>status：<br>回傳一個無符號短整數（unsigned short）表示已發送請求之回應的狀態。通常是 200 或 404 資訊。</li>
<li>statusText：<br>回傳一個 DOMString 表示 HTTP 伺服器回應之字串。和 XMLHTTPRequest.status 不同的是，XMLHttpRequest.statusText 包含了回應的整個文字訊息（如 “200 OK”）。</li>
<li>onreadystatechange()：<br>一個 EventHandler（事件處理器）函式，會於 readyState 屬性之狀態改變時被呼叫。</li>
<li>abort()：<br>中止已發出的請求。會將 readyState 重置歸 0。</li>
<li>getAllResponseHeaders()：<br>回傳所有的回應標頭（response headers），為一以斷行字元（CRLF）分行的字串，如未接收到回應（readystate!&#x3D;4) 則為 null。</li>
<li>getResponseHeader()：<br>回傳指定標頭文字之字串，假如回應尚未被接收或是標頭不存在於回應中則為 null。例如指定 getResponseHeader(“Content-Type”) 則可能回傳 application&#x2F;json; charset&#x3D;UTF-8 或 text&#x2F;plain; charset&#x3D;UTF-8 等資訊。</li>
<li>setRequestHeader()：<br>設定 HTTP 請求標頭（request header）值。必須於 open() 之後、在 send() 之前。</li>
<li>open()：<br>初始化一個請求。此方法用於 JavaScript 中；若要在 native code 中初始化請求，請以 openRequest() 作為替代。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">open</span>(</span><br><span class="line">    <span class="title class_">DOMString</span> method,  <span class="comment">//GET or POST</span></span><br><span class="line">    <span class="title class_">DOMString</span> url, <span class="comment">//target URL</span></span><br><span class="line">    optional boolean <span class="keyword">async</span>, <span class="comment">// true(default is async) or false(sync)</span></span><br><span class="line">    optional <span class="title class_">DOMString</span> user, <span class="comment">//驗證用使用者名稱</span></span><br><span class="line">    optional <span class="title class_">DOMString</span> password <span class="comment">//</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li>send()：<br>發送請求。如果為非同步請求（預設值），此方法將在發出請求後便立即回傳（return）。</li>
</ul>
<h3 id="完整作業順序說明"><a href="#完整作業順序說明" class="headerlink" title="完整作業順序說明"></a>完整作業順序說明</h3><ol>
<li>宣告 XMLHttpRequest<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> jsAjax = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>(); <span class="comment">// 宣告 HTTP 請求之標準物件</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsAjax.<span class="property">readyState</span>); <span class="comment">// 0 =&gt; 已經產生一個 XMLHttpRequest，但是還沒連結要撈的資料</span></span><br></pre></td></tr></table></figure></li>
<li>指定位置與送出</li>
</ol>
<ul>
<li>GET 方式：通常用於直接拿資料（不送資料），如真有必要直接寫在 URL 編碼上來提供。<figure class="highlight javascript"><figcaption><span>GET</span></figcaption><table><tr><td class="code"><pre><span class="line">jsAjax.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;test.json&quot;</span>, <span class="literal">true</span>); <span class="comment">//設定方法與傳送位置，布林值預設為 true（非同步），可指定 true 來執行同步作業。</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsAjax.<span class="property">readyState</span>); <span class="comment">// 1 =&gt; 用了 open，但是還沒傳資料</span></span><br><span class="line">jsAjax.<span class="title function_">send</span>(); <span class="comment">//傳送資料，沒有要送可以 null 不輸入</span></span><br></pre></td></tr></table></figure></li>
<li>POST 方式（以 Form-Data 傳送）：與傳統表單一樣，需要特別宣告 <code>setRequestHeader</code> 方式。<figure class="highlight javascript"><figcaption><span>POST</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">/*********POST 方式：如果你要傳 Form 資料給後端，資料格式如同 URL***********/</span></span><br><span class="line">jsAjax.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;test.php&quot;</span>); <span class="comment">//設定方法與傳送位置，布林值預設為 true（非同步）</span></span><br><span class="line"></span><br><span class="line">jsAjax.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-type&#x27;</span>, <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>); <span class="comment">//告知採用 Form-Data 為 POST 內容</span></span><br><span class="line">jsAjax.<span class="title function_">send</span>(<span class="string">&quot;form=data&amp;number=1&quot;</span>); <span class="comment">//URL 編碼方式塞入資料</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><figcaption><span>test.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>]; <span class="comment">//POST</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$_POST</span>); </span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  Array(</span></span><br><span class="line"><span class="comment">    [form] =&gt; data</span></span><br><span class="line"><span class="comment">    [number] =&gt; 1</span></span><br><span class="line"><span class="comment">  )</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//XMLHttpRequest 傳來的 POST 內容是 Form-Data</span></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>; <span class="comment">// form=data&amp;number=1</span></span><br></pre></td></tr></table></figure></li>
<li>POST 方式（以 Request Payload 傳送）：使用 JSON 方式傳送而不是傳統的 Form 表單內容。<figure class="highlight javascript"><figcaption><span>POST</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">/*********POST 方式：如果你要傳 JSON 或文串給後端，後端需要以 Request Payload 方式處理***********/</span></span><br><span class="line">jsAjax.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;test.php&quot;</span>); <span class="comment">//設定方法與傳送位置，布林值預設為 true（非同步）</span></span><br><span class="line"></span><br><span class="line">jsAjax.<span class="title function_">setRequestHeader</span>(<span class="string">&#x27;Content-type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>); <span class="comment">//預設值可不寫</span></span><br><span class="line">jsAjax.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">form</span>: <span class="string">&#x27;data&#x27;</span>, <span class="attr">number</span>: <span class="number">1</span> &#125;)); <span class="comment">//不要直接丟 JSON 給後端會看不懂，需轉成 string。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/***************************************也可傳送字串類型包含 HTML</span></span><br><span class="line"><span class="comment">jsAjax.send(document);</span></span><br><span class="line"><span class="comment">jsAjax.send(&#x27;string&#x27;);</span></span><br><span class="line"><span class="comment">*********************************************/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(jsAjax.<span class="property">readyState</span>); <span class="comment">// 1 =&gt; 同上參數原因：需要一些時間所以無法立刻用 readyState 看出變化</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><figcaption><span>PHP（後端）</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>]; <span class="comment">//POST</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//XMLHttpRequest 傳來的 POST 內容是 Request Payload</span></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>; <span class="comment">// &#123;&quot;form&quot;:&quot;data&quot;,&quot;number&quot;:1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">json_decode</span>(<span class="variable">$data</span>));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  stdClass Object(</span></span><br><span class="line"><span class="comment">    [form] =&gt; data</span></span><br><span class="line"><span class="comment">    [number] =&gt; 1</span></span><br><span class="line"><span class="comment">  )</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>取得資料來自 responseText<br>這裡可以分成兩種做法，分別是可透過事件 onreadystatechange（狀態變化時觸發）或 onload（作業結束）來完成回應之後續作業。<ul>
<li>onreadystatechange<figure class="highlight javascript"><figcaption><span>Method1:onreadystatechange</span></figcaption><table><tr><td class="code"><pre><span class="line">jsAjax.<span class="property">onreadystatechange</span> = <span class="function">() =&gt;</span> &#123; <span class="comment">//一個 EventHandler（事件處理器）函式，會於 readyState 屬性之狀態改變時被呼叫。</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(jsAjax.<span class="property">readyState</span>); <span class="comment">// 2 （偵測到用 send) -&gt; 3 （資料 loading 中） -&gt; 4 （你撈到資料了，數據已經接收到）</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (jsAjax.<span class="property">readyState</span> == <span class="number">4</span>) &#123;  <span class="comment">//資料已收到</span></span><br><span class="line">    <span class="keyword">if</span> (jsAjax.<span class="property">status</span> == <span class="number">200</span>) &#123;  <span class="comment">// HTTP 狀態碼：200 =&gt;資料正確回傳，404 =&gt; 資料讀取錯誤</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> dataType = jsAjax.<span class="title function_">getResponseHeader</span>(<span class="string">&quot;Content-Type&quot;</span>);   <span class="comment">// 取得回應的資料類型 (String)</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(dataType);</span><br><span class="line">      <span class="comment">/* </span></span><br><span class="line"><span class="comment">        application/json; charset=UTF-8 =&gt; JSON</span></span><br><span class="line"><span class="comment">        text/html; charset=UTF-8 =&gt; HTML or TEXT</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">      <span class="keyword">if</span> (dataType.<span class="title function_">indexOf</span>(<span class="string">&quot;json&quot;</span>) == <span class="number">0</span>) <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsAjax.<span class="property">responseText</span>)); <span class="comment">//如果是 JSON 格式先轉換再輸出</span></span><br><span class="line">      <span class="keyword">if</span> (dataType.<span class="title function_">indexOf</span>(<span class="string">&quot;text&quot;</span>) == <span class="number">0</span>) <span class="variable language_">console</span>.<span class="title function_">log</span>(jsAjax.<span class="property">responseText</span>); <span class="comment">//如果是 TEXT 不處理直接輸出</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;資料錯誤&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>onload<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">jsAjax.<span class="property">onload</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(jsAjax.<span class="property">status</span>, jsAjax.<span class="property">readyState</span>, <span class="string">&quot;method2&quot;</span>);   <span class="comment">// 200 4 &quot;method2&quot;</span></span><br><span class="line">  <span class="comment">/******do something********/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h2 id="jQuery-的-Ajax"><a href="#jQuery-的-Ajax" class="headerlink" title="jQuery 的 Ajax"></a>jQuery 的 Ajax</h2><p>jQuery 是第三方的 JavaScript 函式庫，裡面提供了 Ajax 的完整寫法與多種快速應用。</p>
<h3 id="介紹-ajax"><a href="#介紹-ajax" class="headerlink" title="介紹 $.ajax"></a>介紹 $.ajax</h3><p>jQuery 的 ajax() 是以 jQuery 自己的 Ajax 技術核心來使用，相對來說對於 jQuery 其他的 Ajax 語法比較複雜但比起原生 JavaScript 來說仍然設定上比較快。主體為$.ajax()，其參數設定都是直接用 JSON 格式來設定屬性方法（除了 URL 與 TYPE，其他都非必要）：</p>
<ul>
<li>$.ajax([settings])<br>核心物件，所有行為事件與回應都已參數傳遞進行指定。</li>
<li>type：<br>HTTP 請求的方式 GET 或 POST。預設為 GET 可省略不寫</li>
<li>dataType:<br>取回的資料該用什麼型態來讀取。輸入 xml, json, script, text, html 為選項值。可不指定由 jQuery 自動判斷。</li>
<li>url：<br>目標的 URL 網址。</li>
<li>data:<br>傳送給伺服器端的資料，通常以 JSON 方式傳送。</li>
<li>scucess：<br>請求成功時所需執行的函式，且會結果以傳遞變數回傳。</li>
<li>error：<br>請求失敗時所需執行的函式，並將整個請求之 XHR(XMLHttpRequest) 物件透過傳遞變數給你。</li>
<li>complete：<br>完成事件後（不論成功或失敗）時所需執行的函式，並將整個請求之 XHR 物件透過傳遞變數給你。<br>beforeSend：<br>請求之前時所需執行的函式，也就是 Ajax 對 HTTP 請求之前的階段，並將整個請求之 XHR 物件透過傳遞變數給你。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;test.php&quot;</span>,</span><br><span class="line">  <span class="attr">dataType</span>:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">form</span>: <span class="string">&quot;data&quot;</span>,</span><br><span class="line">    <span class="attr">number</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;success:&quot;</span>, result);</span><br><span class="line">    <span class="comment">/*GETArray(</span></span><br><span class="line"><span class="comment">        [form] =&gt; data</span></span><br><span class="line"><span class="comment">        [number] =&gt; 1</span></span><br><span class="line"><span class="comment">    )*/</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">error</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;error:&quot;</span>, result); <span class="comment">//模擬失敗時，可看到 result.status:404</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">complete</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;complete:&quot;</span>, result); <span class="comment">//顯示傳遞物件，可看到 result.Stateready:4</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">beforeSend</span>: <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;beforeSend:&quot;</span>, result); <span class="comment">//顯示傳遞物件，可看到 result.Stateready:0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><figcaption><span>test.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>]; <span class="comment">//GET</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$_GET</span>);</span><br></pre></td></tr></table></figure>

<h3 id="介紹其他寫法"><a href="#介紹其他寫法" class="headerlink" title="介紹其他寫法"></a>介紹其他寫法</h3><ul>
<li>jQuery.getJSON(url,data,success(data,status,xhr))<br>快速取得 JSON，必要為 url 與 success 函式而其他看需求，同時支援 JSONP 的用途。scucces 分別能提供三種傳遞變數，分別是取回資料、請求狀態、整個 XML(XMLHttpRequest) 之物件<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">getJSON</span>(<span class="string">&quot;test.json&quot;</span>, &#123; <span class="attr">form</span>: <span class="string">&quot;data&quot;</span>, <span class="attr">number</span>: <span class="number">1</span> &#125;, <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;success:&quot;</span>, result);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/***************************************same as</span></span><br><span class="line"><span class="comment">$.ajax(&#123;</span></span><br><span class="line"><span class="comment">  type: &quot;GET&quot;,</span></span><br><span class="line"><span class="comment">  url: &quot;test.json&quot;,</span></span><br><span class="line"><span class="comment">  dataType:&quot;json&quot;,</span></span><br><span class="line"><span class="comment">  data: &#123;</span></span><br><span class="line"><span class="comment">    form: &quot;data&quot;,</span></span><br><span class="line"><span class="comment">    number: 1</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">  success: (result) =&gt; &#123;</span></span><br><span class="line"><span class="comment">    console.log(&quot;success:&quot;, result);</span></span><br><span class="line"><span class="comment">  &#125;&#125;);</span></span><br><span class="line"><span class="comment">  ********************************************/</span></span><br></pre></td></tr></table></figure></li>
<li>$.get(url,data,success(response,status,xhr),dataType)<br>同以下寫法：<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: url,</span><br><span class="line">  <span class="attr">data</span>: data,</span><br><span class="line">  <span class="attr">success</span>: <span class="title function_">success</span>(response,status,xhr),</span><br><span class="line">  <span class="attr">dataType</span>: dataType</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li>$.post(url,data,success(response,status,xhr),dataType)<br>同以下寫法：<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: url,</span><br><span class="line">  <span class="attr">data</span>: data,</span><br><span class="line">  <span class="attr">success</span>: <span class="title function_">success</span>(response,status,xhr),</span><br><span class="line">  <span class="attr">dataType</span>: dataType</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li>$.getScript(url,success(response,status,xhr))<br>能獲取來自另一個地方的腳本，通常讀取當下瀏覽器就會運行了所以不用指定 datatype，與<code>&lt;script src&gt;</code>不同的是你可以決定何時加載。同等以下寫法：<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>:<span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: url,</span><br><span class="line">  <span class="attr">success</span>: <span class="title function_">success</span>(response,status,xhr),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
簡單範例如下：<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">getScript</span>(<span class="string">&quot;test.js&quot;</span>,<span class="function">(<span class="params">re</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;done&quot;</span>,re);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">this is form test.js</span></span><br><span class="line"><span class="comment">done console.log(&quot;this is form test.js&quot;);</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>test.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;this is form test.js&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li>$(selector).load(url)<br>對 selector 進行 url 位置請求，並將取回之 HTML 替換其內容，範例如下：<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  $(<span class="string">&quot;ul&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;list.html&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">&lt;ul&gt;</span></span><br><span class="line"><span class="comment">  &lt;li&gt;001&lt;/li&gt;</span></span><br><span class="line"><span class="comment">  &lt;li&gt;002&lt;/li&gt;</span></span><br><span class="line"><span class="comment">  &lt;li&gt;003&lt;/li&gt;</span></span><br><span class="line"><span class="comment">  &lt;li&gt;004&lt;/li&gt;</span></span><br><span class="line"><span class="comment">  &lt;li&gt;005&lt;/li&gt;</span></span><br><span class="line"><span class="comment">&lt;/ul&gt;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><figcaption><span>list.html</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>001<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>002<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>003<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>004<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>005<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="jqXHR-與-Deferred-遞延物件"><a href="#jqXHR-與-Deferred-遞延物件" class="headerlink" title="jqXHR 與 Deferred 遞延物件"></a>jqXHR 與 Deferred 遞延物件</h3><p>自 jQuery 版本 1.5 開始，所有的 Ajax 應用都會回傳 XMLHTTPRequest 物件的集合，並使用 Promise 建構函式完成窗口回應。你可以從 jqXML 物件找到 done（成功後執行）、fail（失敗後執行）、always（完成後執行，不論成功或失敗）。</p>
<p>另外 jQuery 還透過。Deferred() 方式串起可連接的導向鍊程序物件函式。可另添加 done()、fail()、always() 到你的 JQ Ajax 語法後面，包含所有的簡寫 Ajax 應用。</p>
<ul>
<li>done()、fail()、always()<br>提供成功結果、失敗結果、完成結果之回傳執行，舉例來說：<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;test.php&quot;</span>,</span><br><span class="line">  <span class="attr">dataType</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">form</span>: <span class="string">&quot;data&quot;</span>,</span><br><span class="line">    <span class="attr">number</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="title function_">done</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;done:&quot;</span>, result);</span><br><span class="line">  <span class="comment">/*done: GETArray(</span></span><br><span class="line"><span class="comment">    [form] =&gt; data</span></span><br><span class="line"><span class="comment">    [number] =&gt; 1</span></span><br><span class="line"><span class="comment">  )*/</span></span><br><span class="line">&#125;).<span class="title function_">fail</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fail:&quot;</span>, result); <span class="comment">//失敗時，可看到 XHR 物件且 result.status:404</span></span><br><span class="line">&#125;).<span class="title function_">always</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;always:&quot;</span>, result); <span class="comment">//成功時，可看到回傳內容；失敗時顯示 XHR 物件，可看到 result.Stateready:4</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/********************* same as</span></span><br><span class="line"><span class="comment">$.ajax(&#123;</span></span><br><span class="line"><span class="comment">  type: &quot;GET&quot;,</span></span><br><span class="line"><span class="comment">  url: &quot;test.php&quot;,</span></span><br><span class="line"><span class="comment">  dataType: &quot;string&quot;,</span></span><br><span class="line"><span class="comment">  data: &#123;</span></span><br><span class="line"><span class="comment">    form: &quot;data&quot;,</span></span><br><span class="line"><span class="comment">    number: 1</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">  success: (result) =&gt; &#123;</span></span><br><span class="line"><span class="comment">    console.log(&quot;success:&quot;, result);</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">  error: (result) =&gt; &#123;</span></span><br><span class="line"><span class="comment">    console.log(&quot;error:&quot;, result);</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">  complete: (result) =&gt; &#123;</span></span><br><span class="line"><span class="comment">    console.log(&quot;complete:&quot;, result);</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">  beforeSend: (result) =&gt; &#123;</span></span><br><span class="line"><span class="comment">    console.log(&quot;beforeSend:&quot;, result);</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;);</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><figcaption><span>test.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>]; <span class="comment">//GET</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$_GET</span>);</span><br></pre></td></tr></table></figure></li>
<li>then(doneCallbacks,failCallbacks)<br>then 也是 Promise 下的產物，能提供同步延遲後的成功與失敗行為，簡單來說可以一筆取代 done() 與 fail() 的兩筆宣告。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;test.php&quot;</span>,</span><br><span class="line">  <span class="attr">dataType</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">form</span>: <span class="string">&quot;data&quot;</span>,</span><br><span class="line">    <span class="attr">number</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;).<span class="title function_">then</span>(</span><br><span class="line">  <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;   <span class="comment">//same as done()</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;then-done:&quot;</span>, result);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;  <span class="comment">// same as fail()</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fail:&quot;</span>, result);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure></li>
<li>when(Ajax,Ajax)<br>提供解決多個非同步問題下的回呼執行處理，隨著多個 Deferred 物件提供給 when() 執行，由 when 來收集這些返回的集合體再從 when 本身的 Deferred 物件來執行本身 then 或其他方法 (done,fail,always) 來執行所有結果。</li>
</ul>
<ol>
<li>如果 when() 的參數安插一個 Ajax 語法會回傳內容、狀態、XHR 物件，你可以接上 then() 來執行。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">when</span>(</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;text1.txt&quot;</span>   <span class="comment">// string &quot;HELLO&quot; in File</span></span><br><span class="line">  &#125;)</span><br><span class="line">).<span class="title function_">then</span>(<span class="function">(<span class="params">data, textState, xhr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data, textState, xhr);<span class="comment">//HELLO scucess XHR Object</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li>如果 when() 的參數安插多個 Ajax 語法會回傳內容、狀態、XHR 物件，你可以接上 then() 來執行。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">when</span>(</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;text1.txt&quot;</span></span><br><span class="line">  &#125;),</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;text2.txt&quot;</span></span><br><span class="line">  &#125;)</span><br><span class="line">).<span class="title function_">then</span>(</span><br><span class="line">  <span class="function">(<span class="params">re1, re2</span>) =&gt;</span> &#123; <span class="comment">//done</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(re1, re2); <span class="comment">// 能獲得兩組偽陣列格式 [responseText,state,XHR Object]</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(re1[<span class="number">0</span>] + <span class="string">&quot; &quot;</span> + re2[<span class="number">0</span>]); <span class="comment">//HELLO WORLD</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">re1, re2</span>) =&gt;</span> &#123; <span class="comment">//</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(re1); <span class="comment">// XHR Object</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(re2); <span class="comment">// error</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight txt"><figcaption><span>hext1.text</span></figcaption><table><tr><td class="code"><pre><span class="line">HELLO</span><br></pre></td></tr></table></figure>
<figure class="highlight txt"><figcaption><span>hext2.text</span></figcaption><table><tr><td class="code"><pre><span class="line">WORLD</span><br></pre></td></tr></table></figure></li>
<li>如果 when() 的參數沒有指定，也會進行 Promise 處理返回，由於沒有請求只會 return 乾淨的 XHR 物件。如參數不是 Ajax 指令 (Deferred)，則會直接 Callback 還你，相信你不會做這無聊的事。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$.<span class="title function_">when</span>(<span class="string">&quot;AAA&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(e);<span class="comment">//AAA</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="JavaScript-的-fetch-API"><a href="#JavaScript-的-fetch-API" class="headerlink" title="JavaScript 的 fetch API"></a>JavaScript 的 fetch API</h2><p>從 ES6 開始提供了 fetch 如此方便的跨網路資源介面，主要是 XMLHttpRequest 舊技術的替代方案。同時越來越多人捨去 jQuery Ajax 技術直接使用原 JavaScript 來處理一切包含 Ajax 應用。提供 URL 位置給 fetch 接著透過 Promise 建構式來獲取 Response（不論成功或失敗都會取得回應），如果需要提供設定直接使用第二筆參數 init 物件（使用 Request 建構式）來調整。結論來說 fetch 只是一個官方設計過後的 API，且透過 Promise 與 Request 物件來達到 Ajax 應用（也可自行用 Promise 與 Request 物件 DIY 一個 Ajax 之 API，但何必這麼累）。</p>
<h3 id="初次使用-Fetch-（取得-JSON"><a href="#初次使用-Fetch-（取得-JSON" class="headerlink" title="初次使用 Fetch （取得 JSON)"></a>初次使用 Fetch （取得 JSON)</h3><p>試著看看以下簡單範例步驟：</p>
<ol>
<li>使用 fetch 並指定 url 位址，如果需要可以對第二參數（稱呼 init 物件）使用 JSON 格式編寫（這裡故意寫 GET ，預設 GET 可不寫）。</li>
<li>當透過 then() 來後續處理，fetch 最後回傳一個 Response 物件給你 (HTTP 回應資訊），這不是真正的內容結果。</li>
<li>要找到真正的內容，必需從 Response 裡面的 Body 物件（為 Body mixin 也是 Promise 與 Request 的物件 API，為申明內容該以什麼方式處理輸出），使用 Body 的 json() 或 text() 來處理內容回傳。</li>
<li>直接使用 Response.json() 方法讓我們透過 Body API 來回應出 JSON 字串，因此我們要再用一次 then() 來後續處理結果。</li>
<li>在那之前先 return response.json() 出來給下一個 then()。</li>
<li>第二個 then 將接受到 JSON 資料，才算真正取得內容。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;test.json&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;GET&#x27;</span></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(response);<span class="comment">//得到 response 物件，而不是回傳內容</span></span><br><span class="line">  <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">json</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(json)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Error:&#x27;</span>, error)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********善用箭頭函式特性與簡略 GET 你可以簡寫成這樣</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">fetch(&#x27;test.json&#x27;)</span></span><br><span class="line"><span class="comment">  .then(response =&gt; response.json())</span></span><br><span class="line"><span class="comment">  .then(json =&gt; console.log(json))</span></span><br><span class="line"><span class="comment">  .catch( error =&gt; console.log(&#x27;Error:&#x27;, error) );</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  **************************************/</span></span><br></pre></td></tr></table></figure>

<h3 id="Fetch-可用設定"><a href="#Fetch-可用設定" class="headerlink" title="Fetch 可用設定"></a>Fetch 可用設定</h3><p>使用 Fetch 時可提供第二筆參數，這裡被稱呼為 init 物件且以 JSON 格式進行編寫提供 Request 使用（你可以在 MDN 找到 Request 的說明手冊），提供參數如下 (*代表預設值）：</p>
<ul>
<li>method:<br>使用方法，如 *GET, POST, PUT, DELETE</li>
<li>headers:<br>表頭類型可以是 Headers 物件或 ByteString 值。舉例寫法：<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/4.0 MDN Example&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//////or</span></span><br><span class="line"><span class="attr">headers</span>: <span class="keyword">new</span> <span class="title class_">Headers</span>(&#123;</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>body:<br>BODY 指定的資料可以是 Blob, BufferSource, FormData, URLSearchParams, USVString。不允許對 GET 或 HEAD 方法使用。</li>
<li>mode:<br>模式採用 cors（跨網）, no-cors（非跨網）, *same-origin（同源政策，限定同網域下）。</li>
<li>credentials:<br>request 認證應用，表示用戶代理在跨網請求下能否發送 Cookie，可以是 *omit（不發送 Cookie), same-origin（同網域下才使用）, include（可發送 Cookie)。</li>
<li>cache:<br> 請求的暫存模式，可以是 *default, no-store, reload, no-cache, force-cache, only-if-cached。</li>
<li>redirect:<br>處理重新導向方式，可以是 *follow（自動重定向）, error（如果產生重定向將自動終止並且拋出一個錯誤）, manual（手動處理重定向）。</li>
<li>referrer:<br>參照位址來源，表示從哪裡到目前的網頁。可以是 no-referrer, *client, URL。</li>
<li>referrerPolicy:<br>指定 HTTP 表頭 referer 值。可以是 no-referrer, no-referrer-when-downgrade, origin, origin-when-cross-origin, unsafe-url。</li>
<li>integrity:<br>资源完整性 (SRI) 的值，例如 <code>integrity=&quot;sha384-oqVuAfXRKap7fdgcCY5uykM6+R9GqQ8K/uxy9rx7HNQlGYl1kPzQho1wx4JwY8wC&quot;</code>，也很常在 CDN 引用時看到。</li>
</ul>
<h3 id="使用範例"><a href="#使用範例" class="headerlink" title="使用範例"></a>使用範例</h3><ul>
<li>POST Request：(by FormData)<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> data = <span class="keyword">new</span> <span class="title class_">FormData</span>(); <span class="comment">// 需使用 FormData 建構式來做資料，由 body 去偵測採用 FormData 傳送</span></span><br><span class="line">  data.<span class="title function_">append</span>(<span class="string">&quot;form&quot;</span>,<span class="string">&quot;data&quot;</span>);</span><br><span class="line">  data.<span class="title function_">append</span>(<span class="string">&quot;number&quot;</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*******反之有個情況整個 FORM 表單要提交，可以直接指定整個節點一起為 Data 送過去，FormData 建構式會聰明算進去</span></span><br><span class="line"><span class="comment">let data = new FormData(document.getElementById(&#x27;myform&#x27;));</span></span><br><span class="line"><span class="comment">*******************************/</span> </span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;test.php&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">  <span class="attr">body</span>: data</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">text</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/********console.log********</span></span><br><span class="line"><span class="comment">  POSTArray(</span></span><br><span class="line"><span class="comment">    [form] =&gt; data</span></span><br><span class="line"><span class="comment">    [number] =&gt; 1</span></span><br><span class="line"><span class="comment">  )**************************/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><figcaption><span>test.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>]; <span class="comment">//GET</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$_POST</span>);</span><br></pre></td></tr></table></figure></li>
<li>POST Request：(by Request Payload)<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;test.php&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">  <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="comment">//須 JSON 物件轉成字串，後端才能判讀</span></span><br><span class="line">    <span class="attr">form</span>: <span class="string">&quot;data&quot;</span>,</span><br><span class="line">    <span class="attr">number</span>: <span class="number">1</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">text</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error));</span><br><span class="line"></span><br><span class="line"><span class="comment">/********console.log********</span></span><br><span class="line"><span class="comment">POSTRequest Payload:&#123;&quot;form&quot;:&quot;data&quot;,&quot;number&quot;:1&#125;</span></span><br><span class="line"><span class="comment">)**************************/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><figcaption><span>test.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>]; <span class="comment">//GET</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//XMLHttpRequest 傳來的 POST 內容是 Request Payload</span></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Request Payload:&quot;</span>.<span class="variable">$data</span>; <span class="comment">// &#123;&quot;form&quot;:&quot;data&quot;,&quot;number&quot;:1&#125;</span></span><br></pre></td></tr></table></figure></li>
<li>確認成功與失敗<br>遇到 CORS 或 server 設定錯誤導致 network error 時，promise 會 reject 並附上 TypeError 的回應，但在權限或類似問題導致 404 的常見狀況下，卻不會導致 network error。因此是否成功的正確方式，應包含檢查 promise resolved, 以及檢查 Response.ok 的屬性是否為 true。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;404.json&#x27;</span>) <span class="comment">//此 URL 故意不存在情況下</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">    <span class="keyword">if</span>(response.<span class="property">ok</span>) <span class="keyword">return</span> response.<span class="title function_">json</span>();</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(response.<span class="property">status</span>); <span class="comment">//建立 error 物件提供給 catch() 取得，並中斷後續所有動作</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;這行不會被執行到&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">json</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(json))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;發生錯誤代碼為&quot;</span>+error.<span class="property">message</span>));<span class="comment">//取出 error 物件的資訊顯示出來</span></span><br></pre></td></tr></table></figure></li>
<li>多筆 Request 同時進行 Fetch<br>可透過 Promise.all() 方進行等待作業，最後一起 then() 完成動作。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&quot;textr1.txt&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">re</span> =&gt;</span> re.<span class="title function_">text</span>()), <span class="comment">// &#x27;HELLO&#x27; string in file</span></span><br><span class="line">  <span class="title function_">fetch</span>(<span class="string">&quot;text2.txt&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">re</span> =&gt;</span> re.<span class="title function_">text</span>()) <span class="comment">// &#x27;WORLD&#x27; string in file</span></span><br><span class="line">]).<span class="title function_">then</span>(<span class="function">(<span class="params">[r1, r2]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(r1, r2); <span class="comment">//HELLO WORLD</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="停止取得"><a href="#停止取得" class="headerlink" title="停止取得"></a>停止取得</h3><p>近期瀏覽器可以使用 AbortController API 來完成停止需求，等同於 xhr.abort() 行為或 xhr.onabort() 事件。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;test.json&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">signal</span>: controller.<span class="property">signal</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">json</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(json))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error)); <span class="comment">//DOMException: The user aborted a request.</span></span><br><span class="line"></span><br><span class="line">controller.<span class="title function_">abort</span>(); <span class="comment">//這裡馬上取消請求，導致 catch 產生 error 資訊</span></span><br></pre></td></tr></table></figure>

<h2 id="axios-框架的-Ajax"><a href="#axios-框架的-Ajax" class="headerlink" title="axios 框架的 Ajax"></a>axios 框架的 Ajax</h2><p>fetch 尚未普及的年代的產物（目前也是很多人使用且為了脫離 jQuery 習慣，你也會在 vue 上面看到 axios 的蹤跡），類似 jQuery 需要額外套入的框架包。使用方式與 fetch 差不多，Axios 也依賴 JavaScript 的 promise 來完成 Ajax 應用。</p>
<p>你需要先安裝匯入 axios 使用，這裡採用 cdn 來處理。</p>
<figure class="highlight html"><figcaption><span>axios cdn</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.0/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="初次使用-Axios-API（取得-JSON"><a href="#初次使用-Axios-API（取得-JSON" class="headerlink" title="初次使用 Axios API（取得 JSON)"></a>初次使用 Axios API（取得 JSON)</h3><p>類似 jQuery 的 Ajax 方法與 fetch 的 promiise，其語法為 axios(config)。除了完整寫法 axios API，也有其他簡寫方式，完整寫法如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;test.json&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);<span class="comment">//整個回應物件在此</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>);<span class="comment">//內容在此</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error));</span><br></pre></td></tr></table></figure>

<h3 id="axios-API-的-config-可用設定"><a href="#axios-API-的-config-可用設定" class="headerlink" title="axios API 的 config 可用設定"></a>axios API 的 config 可用設定</h3><p>使用 axiosAPI 完整寫法，必需提供 config 物件內容，除了 URL 是必要的其他參數都可以因需求加入（未特別標示則為 string 值），使用參數非常的多可以分為幾大類：</p>
<h4 id="一般參數"><a href="#一般參數" class="headerlink" title="一般參數"></a>一般參數</h4><ul>
<li>url:<br>目標的 URL 網址，必填。</li>
<li>method:<br>HTTP 請求的方式 GET 或 POST。預設為 GET 可省略不寫</li>
<li>headers:<br>表頭類型可以是 Headers 物件或 ByteString 值。舉例寫法：<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">headers</span>: &#123;</span><br><span class="line">  <span class="string">&#x27;user-agent&#x27;</span>: <span class="string">&#x27;Mozilla/4.0 MDN Example&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//////or</span></span><br><span class="line"><span class="attr">headers</span>: <span class="keyword">new</span> <span class="title class_">Headers</span>(&#123;</span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>baseURL:<br>目標的網域名稱，會自動添加在 url 前面。如果 url 已經是絕對路徑可省略。</li>
<li>data:object<br>傳送的資料，只適合 PUT, POST, PATCH 類型使用。</li>
<li>params:object<br>轉換資料為 URL 參數，適合 GET 變數的傳遞或類型使用。若你直接 URL 上寫好可省略。</li>
<li>maxContentLength:number<br>限制內容傳送上限</li>
<li>timeout:number<br>請求時間超過時間（毫秒）時，將終止此請求。</li>
<li>responseType:<br>回傳的資料格式為何，可以是 arraybuffer, document, json’（預設）, text, stream, blob</li>
<li>responseEncoding:<br>回應的資料其編碼模式為何，預設為 utf8</li>
</ul>
<h4 id="promise-前後處理"><a href="#promise-前後處理" class="headerlink" title="promise 前後處理"></a>promise 前後處理</h4><ul>
<li>onUploadProgress:(function), onDownloadProgress:(function)<br>在上下傳時可執行的函式，並可提供 ProgressEvent 物件作為傳遞參數<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">onUploadProgress</span>: <span class="keyword">function</span> (<span class="params">progressEvt</span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(progressEvt) &#125;,</span><br><span class="line"><span class="attr">onDownloadProgress</span>: <span class="keyword">function</span> (<span class="params">progressEvt</span>) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(progressEvt) &#125;</span><br></pre></td></tr></table></figure></li>
<li>adapter:function()<br>不使用預設的 promise 處理，使用自定義的 promise 之函式作業</li>
<li>transformRequest:[function(data){return}], transformResponse:[function(data){return}]<ul>
<li>Request 前的資料可以先處理，你可以提交之前對 data 做調整。此功能只對 PUT, POST, PATCH 有效。</li>
<li>Response 前的資料可以先做處理。你可以提交之前對 data 做調整。此功能只對 PUT, POST, PATCH 有效。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">axios</span>(&#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;test.php&#x27;</span>,</span><br><span class="line">  <span class="attr">transformRequest</span>: [<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//這裡額外先將 JSON 物件轉成 FormData，使後端取得的會是 FormData 而不是透過 Request Payload 來拿</span></span><br><span class="line">    formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> data) formData.<span class="title function_">append</span>(key, data[key]);</span><br><span class="line">    <span class="keyword">return</span> formData;</span><br><span class="line">  &#125;],</span><br><span class="line">  <span class="attr">transformResponse</span>: [<span class="function"><span class="params">data</span> =&gt;</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data)],</span><br><span class="line">  <span class="comment">//我們原取得的內容是 string，先轉成 JSON 才會往 then(),catch() 整合 Response</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">form</span>: <span class="string">&#x27;data&#x27;</span>,</span><br><span class="line">    <span class="attr">number</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>)) <span class="comment">//取出來已經是 JSON 不用再處理</span></span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error));</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><figcaption><span>test.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$_POST</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="網域驗證代理"><a href="#網域驗證代理" class="headerlink" title="網域驗證代理"></a>網域驗證代理</h4><ul>
<li>withCredentials:boolean<br>判斷是否為跨域存取 (CROS)，預設為 false</li>
<li>auth:object<br>設定 Authorization 表頭資料，提供驗證使用。</li>
<li>xsrfCookieName<br>用於 xsrf token 值的 cookie 名稱</li>
<li>xsrfHeaderName<br>532xsrf token 值的 header 名稱</li>
<li>validateStatus:function(status){return boolean}<br>判斷請求的網址狀態值為多少才會執行 Promise 的 reject 作業。預設操作為 <code>return 200 &lt;= status &amp;&amp; status &lt; 300;</code></li>
<li>proxy:object<br>定義代理伺服器，其中參數 auth 為 proxy 驗證帳密。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">proxy</span>: &#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">  <span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">  <span class="attr">auth</span>: &#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;mikeymike&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;rapunz3l&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>cancelToken<br>用於清除 Token 的請求</li>
</ul>
<h4 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h4><ul>
<li>maxRedirects:number<br>定義 node.js 需遵守的重定向 follow 次數</li>
<li>httpAgent, httpsAgent<br>定義 node.js 執行 http 或 https 時的自訂代理配置</li>
</ul>
<h3 id="介紹所有-axios-速寫法"><a href="#介紹所有-axios-速寫法" class="headerlink" title="介紹所有 axios 速寫法"></a>介紹所有 axios 速寫法</h3><ul>
<li>axios.get(url, config)<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;test.php&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">params</span>: &#123;</span><br><span class="line">    <span class="attr">form</span>: <span class="string">&#x27;data&#x27;</span>,</span><br><span class="line">    <span class="attr">number</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>)) <span class="comment">//取出來已經是 JSON（預設）不用再處理</span></span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error));</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><figcaption><span>test.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$_GET</span>);</span><br></pre></td></tr></table></figure></li>
<li>axios.post(url, data, config)<br>沒有特別處理時，傳的內容會是 Payload<figure class="highlight javascript"><figcaption><span>Request Payload</span></figcaption><table><tr><td class="code"><pre><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;test.php&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">form</span>: <span class="string">&#x27;data&#x27;</span>,</span><br><span class="line">  <span class="attr">number</span>: <span class="number">1</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>)) <span class="comment">//取出來已經是 JSON（預設）不用再處理</span></span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//console: &#123;form: &quot;data&quot;, number: &quot;1&quot;&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><figcaption><span>test.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">//傳來的 POST 內容是 Request Payload</span></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$data</span>; <span class="comment">//&#123;&quot;form&quot;:&quot;data&quot;,&quot;number&quot;:1&#125;</span></span><br></pre></td></tr></table></figure>
如果要用 FormData 傳過來，就不要用 json 格式，而是用 formData 來建構物件。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> bodyFormData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">bodyFormData.<span class="title function_">append</span>(<span class="string">&quot;form&quot;</span>, <span class="string">&quot;data&quot;</span>);</span><br><span class="line">bodyFormData.<span class="title function_">append</span>(<span class="string">&quot;number&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">axios.<span class="title function_">post</span>(<span class="string">&quot;test.php&quot;</span>, bodyFormData)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>)) <span class="comment">//取出來已經是 JSON 不用再處理</span></span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error));</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><figcaption><span>formData</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$_POST</span>);</span><br></pre></td></tr></table></figure></li>
<li>axios.all()<br>多筆 Request 同時進行，並藉由 axios.spread() 取出所有的 response。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">axios.<span class="title function_">all</span>([</span><br><span class="line">  axios.<span class="title function_">get</span>(<span class="string">&quot;text1.txt&quot;</span>), <span class="comment">//string HELLO in file</span></span><br><span class="line">  axios.<span class="title function_">get</span>(<span class="string">&quot;text2.txt&quot;</span>) <span class="comment">//string WORLD in file</span></span><br><span class="line">]).<span class="title function_">then</span>(</span><br><span class="line">  axios.<span class="title function_">spread</span>(</span><br><span class="line">    <span class="function">(<span class="params">response1, response2</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(response1.<span class="property">data</span>, response2.<span class="property">data</span>); <span class="comment">//HELLO WORLD</span></span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error));</span><br></pre></td></tr></table></figure></li>
</ul>
<p>這裡還有其他的方式不再示範：</p>
<ul>
<li>axios(config)：完整的寫法已示範過</li>
<li>axios.request(config)：與上相同功能</li>
<li>axios.head(url, config)：功能與 GET 相同但無 response body，也就是單向傳出不拿東西回來。</li>
<li>axios.delete(url, config)：DELETE 請求類型</li>
<li>axios.put(url, data, config)：PUT 請求類型</li>
<li>axios.patch(url, data, config)：PATCH 請求類型</li>
<li>axios.options(url, config) &#x2F;&#x2F; 檢查用，預先發送的請求是否安全。確認該地址採用的協定、要求的表頭等資訊。</li>
<li>axios.create(config) &#x2F;&#x2F;自定義設定 axios</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;test.json&quot;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(response); <span class="comment">//整個回應物件在此</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(response.<span class="property">data</span>); <span class="comment">//內容在此</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err));</span><br></pre></td></tr></table></figure>

<h2 id="認識-Promise"><a href="#認識-Promise" class="headerlink" title="認識 Promise"></a>認識 Promise</h2><p>promise 從 ES6 的新語法，主要是解決程式執行順序上發生不同步的問題。也就是程式繼續往下跑不會等待某行的結果，這是為了工作效率而預定作業方式。例如可由 settimeout 來實現此問題：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;AA&quot;</span>;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  str = <span class="string">&quot;BB&quot;</span>;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str); <span class="comment">//發生非同步執行緒問題，此程式不會等上面的程式跑完。</span></span><br></pre></td></tr></table></figure>

<p>因此許多 Ajax 應用方式因為需要從別處拿資料回來才能繼續執行，就可以選擇是否要求 async（非同步）為關閉。舉例 juqery 的舊方式 (1.5 版本開始也已改 promise 方法，像是 then 應用）：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> data=<span class="literal">null</span>;</span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>:<span class="string">&quot;test.json&quot;</span>,</span><br><span class="line">  <span class="attr">async</span>:<span class="literal">false</span>,</span><br><span class="line">  <span class="attr">success</span>:<span class="function"><span class="params">re</span>=&gt;</span>data=re</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data); <span class="comment">//這行會等上面的程式跑完才會執行</span></span><br></pre></td></tr></table></figure>
<p>這只是 jQuery Ajax 的非同步示範，如果以一般程式來聊要如何實現？因此 Promise 建構式就是來解決有需要做處理等待的程式代碼。導致現在很多 AjaxAPI 或框架幾乎都是靠 Promise 來處理同步等待的需求。</p>
<h3 id="Promise-基本原型"><a href="#Promise-基本原型" class="headerlink" title="Promise 基本原型"></a>Promise 基本原型</h3><p>Promise 直白點就是對你許下承諾（相信我，我一定會把佐助帶回來的？!）不論這個結果成功還是失敗。以下是 Promise 工作週期說明：<br><img src="https://i.imgur.com/P8z88FS.jpg" alt="Promise 工作週期"></p>
<p>大致上 Promise 有三個階段：</p>
<ul>
<li>擱置（pending）：初始狀態。</li>
<li>實現（fulfilled）：表示操作成功地完成。透過。then(onFullfillment) 來處理資料並回傳後，回到 pending 狀態。</li>
<li>拒絕（rejected）：表示操作失敗了。透過。then(onRejection) 做失敗的應對並回傳，回到 pending 狀態。</li>
</ul>
<p>使用 Promise 建構式時，需要提供 resolve 與 reject 兩個函式參數，分別在 fulfill 及 reject 階段作為 resolve 與 reject 函式的傳遞 status，使得。then() 與。catch() 能收到資料做後續作業。語法結構如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> myPromise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">resolve</span>(status); <span class="comment">// 成功時</span></span><br><span class="line">  <span class="title function_">reject</span>(status); <span class="comment">// 失敗時</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data)) <span class="comment">// on fulfillment（已實現時）</span></span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data));  <span class="comment">// on rejection（已拒絕時）</span></span><br></pre></td></tr></table></figure>

<p>舉個例子：我們需要等到 Promise 工作完成後，根據某條件下成功或失敗決定要往 then 還是 catch 做之後的處理。整體作業是同步的，then 跟 catch 一定會等 Promise 作業結束才會觸發。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mytime = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> rand = <span class="title class_">Math</span>.<span class="title function_">random</span>();</span><br><span class="line">  (rand &gt; <span class="number">0.5</span>) ? <span class="title function_">resolve</span>(<span class="string">&quot;BIG&quot;</span>) : <span class="title function_">reject</span>(<span class="string">&quot;SMALL&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data))  <span class="comment">//BIG</span></span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error)); <span class="comment">//SMAIL</span></span><br></pre></td></tr></table></figure>

<p>回到工作階段說明圖，then() 透過 return 繼續緊接 then() 或 catch()，繼續往下一個階段但已經跟 Promise 無關，只是單純的往後面跑。下面範例不加入失敗考量，直接都是成功的連續 then 執行。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> sayABC = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;A&quot;</span>);  <span class="comment">//A</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;B&quot;</span>), <span class="number">1000</span>);  <span class="comment">//1 秒後將 B 傳送到成功事件</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123; <span class="comment">//成功事件運作顯示 B。並且 return C 離開 then()</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data); <span class="comment">//AB 這兩個字是透過 Promise 來控制執行緒之同步順序，所以 B 會等 A 跑出來</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;C&quot;</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123; <span class="comment">//這裡的 then() 突然可接收到 C，1 秒後印出 C</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data), <span class="number">1000</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;D&quot;</span>); <span class="comment">// 跟上面這行已經非同步處理緒，所以 D 比 C 早出來。</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// console is A B D C</span></span><br></pre></td></tr></table></figure>

<p>由於 then 可以 return，因此我們可以把一個 promise.then() 塞到另一個 promise 內形成連鎖的請求同步。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> say123 = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>); <span class="comment">//這裡跑一，建構 Promise 當下有 run</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">res</span>(<span class="number">2</span>), <span class="number">3000</span>); <span class="comment">// 3 秒後會送數字 2 給 say123.then()</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;A&quot;</span>); <span class="comment">//這裡跑二，建構 Promise 當下有 run</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;B&quot;</span>), <span class="number">1000</span>); <span class="comment">// 1 秒後送文字 B 給 sayABC.then()</span></span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123; <span class="comment">//第 1 秒後這裡開始作業</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);<span class="comment">//這裡跑三</span></span><br><span class="line">    <span class="keyword">return</span> say123.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> data);<span class="comment">//say123 在第 3 秒後這裡開始作業回傳數字 3 到外面，3 又被 say.then() 傳出去</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123; <span class="comment">//say.then().then() 吃到 3，且整體時間第 3+1 秒才輸出</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data), <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//console is 1 A B 2</span></span><br></pre></td></tr></table></figure>

<p>如果是想印出 AB12，你應該在 AB 的 then() 才去建構出顯示 12 的 Promise。形成完整的同步處理並善用 then(return) 應用。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;A&quot;</span>); <span class="comment">//A at time 0</span></span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(<span class="string">&quot;B&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);<span class="comment">//B at time 1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);<span class="comment">//1 at time 1</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">res</span>(<span class="number">2</span>), <span class="number">3000</span>); <span class="comment">// at time 1+3 to run</span></span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> data); <span class="comment">// same as sayABC.then(return (return 2));</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data), <span class="number">1000</span>); <span class="comment">//2 at time 1+3+1 run</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//console is A B 1 2</span></span><br></pre></td></tr></table></figure>

<h3 id="Promise-多項目方法"><a href="#Promise-多項目方法" class="headerlink" title="Promise 多項目方法"></a>Promise 多項目方法</h3><ul>
<li>Promise.all()<br>提供需要多個 promise 一起運作，同時最後一起跑到 then() 作業。提供參數為陣列寫法（可以是 Promise 物件也可以是一般變數內容。返回的資料也是陣列結構。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span><span class="built_in">setTimeout</span>(<span class="title function_">resolve</span>(<span class="string">&quot;A&quot;</span>),<span class="number">1000</span>)),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span><span class="built_in">setTimeout</span>(<span class="title function_">resolve</span>(<span class="string">&quot;B&quot;</span>),<span class="number">1000</span>)),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span><span class="built_in">setTimeout</span>(<span class="title function_">resolve</span>(<span class="number">1</span>),<span class="number">1000</span>)),</span><br><span class="line">  <span class="number">2</span></span><br><span class="line">]).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(data)); <span class="comment">//(4) [&quot;A&quot;, &quot;B&quot;, 1, 2]</span></span><br></pre></td></tr></table></figure>
注意的是如果只要有 Promise 是 reject 狀態，會導致 promise.all().then() 不會運作。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="title function_">resolve</span>(<span class="string">&quot;A&quot;</span>), <span class="number">1000</span>)),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="title function_">resolve</span>(<span class="string">&quot;B&quot;</span>), <span class="number">1000</span>)),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="title function_">reject</span>(<span class="string">&quot;fail&quot;</span>), <span class="number">1000</span>)),</span><br><span class="line">  <span class="number">2</span></span><br><span class="line">]).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data)) <span class="comment">//this not work</span></span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err)); <span class="comment">// console is fail</span></span><br></pre></td></tr></table></figure></li>
<li>Promise.allSettled()<br>Promise.all() 的完整版，回傳的不會是內容而是整個 reponse 資訊，這樣不會因為某個 promise 失敗而導致停擺。你可以自行去取得各自的內容與應對。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">allSettled</span>([</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="title function_">resolve</span>(<span class="string">&quot;A&quot;</span>), <span class="number">1000</span>)),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(<span class="title function_">resolve</span>(<span class="string">&quot;B&quot;</span>), <span class="number">1000</span>)),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="built_in">setTimeout</span>(<span class="title function_">reject</span>(<span class="string">&quot;fail&quot;</span>), <span class="number">1000</span>)),</span><br><span class="line">  <span class="number">2</span></span><br><span class="line">]).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data)) <span class="comment">//</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  (4) [&#123;…&#125;, &#123;…&#125;, &#123;…&#125;, &#123;…&#125;]</span></span><br><span class="line"><span class="comment">  0: &#123;status: &quot;fulfilled&quot;, value: &quot;A&quot;&#125;</span></span><br><span class="line"><span class="comment">  1: &#123;status: &quot;fulfilled&quot;, value: &quot;B&quot;&#125;</span></span><br><span class="line"><span class="comment">  2: &#123;status: &quot;rejected&quot;, reason: &quot;fail&quot;&#125;</span></span><br><span class="line"><span class="comment">  3: &#123;status: &quot;fulfilled&quot;, value: 2&#125;</span></span><br><span class="line"><span class="comment">  length: 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
<li>Promise.race()<br>與 Promise.all 雷同，但只會取得第一個最快成功的 promise 就結束，但要注意只要一個失敗就會整個停擺。<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">3000</span>, <span class="string">&quot;A&quot;</span>)),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>, <span class="string">&quot;B&quot;</span>)),</span><br><span class="line">]).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data)) <span class="comment">// &quot;B&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="async-與-awit"><a href="#async-與-awit" class="headerlink" title="async 與 awit"></a>async 與 awit</h3><p>一種讓 promise 更好寫的方法。主要重點是兩個關鍵字宣告，async 放在某個函式前面代表這個函式等於 promise 且 return 出來的必定是成功的 resolved。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;A&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>().<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>); <span class="comment">//A，我懶得寫傳遞變數了。不然你可以寫 data=&gt;console.log(data)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/******************************same as</span></span><br><span class="line"><span class="comment">async function fn()&#123;</span></span><br><span class="line"><span class="comment">  return Promise.resolve(1);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">fn().then(console.log);</span></span><br><span class="line"><span class="comment">**************************************/</span></span><br></pre></td></tr></table></figure>

<p>另外的關鍵字 await，他必須是放在 async 裡面。主要是當 async 函式內的 promise 執行 resolve 才會觸發。也就拿來替代 then() 的寫法。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> mypro = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>, <span class="string">&quot;A&quot;</span>));</span><br><span class="line">  <span class="keyword">let</span> ans = <span class="keyword">await</span> mypro; <span class="comment">//這裡發生同步，會等待 promise 完成 resolve</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(ans);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>();</span><br><span class="line"><span class="comment">/****************************************************************same as</span></span><br><span class="line"><span class="comment">const fn = async () =&gt; &#123;</span></span><br><span class="line"><span class="comment">  let ans = await new Promise(resolve =&gt; setTimeout(resolve, 1000, &quot;A&quot;));</span></span><br><span class="line"><span class="comment">  console.log(ans);</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">fn();</span></span><br><span class="line"><span class="comment">************************************************************************/</span></span><br></pre></td></tr></table></figure>

<p>然而 async 內要發生 reject 事件指定 throw 即可。他會將資料傳給 catch 內。且會中斷整個函式執行。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="string">&quot;error&quot;</span>;  <span class="comment">//same reject</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;A&quot;</span>; <span class="comment">//same resolve</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">fn</span>().<span class="title function_">then</span>(<span class="variable language_">console</span>.<span class="property">log</span>).<span class="title function_">catch</span>(<span class="variable language_">console</span>.<span class="property">log</span>); <span class="comment">//error</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/****************************************************************same as</span></span><br><span class="line"><span class="comment">const fn = async () =&gt; &#123;</span></span><br><span class="line"><span class="comment">  await Promise.reject(&quot;error&quot;);</span></span><br><span class="line"><span class="comment">  Promise.resolve(&quot;A&quot;);</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">fn().then(console.log).catch(console.log); //error</span></span><br><span class="line"><span class="comment">************************************************************************/</span></span><br></pre></td></tr></table></figure>

<p>舉例來說，使用 fetch() 函式本身會有自己 reject 事件，因此我們可以用 try-catch 來做一個語法表示。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;error.json&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(response);<span class="comment">//獲得一個完整 response 物件</span></span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">await</span> response.<span class="title function_">json</span>(); <span class="comment">//取得失敗</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err); <span class="comment">// SyntaxError: Unexpected token &lt; in JSON at position 0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>();</span><br></pre></td></tr></table></figure>
<p>如果不使用 try-catch 來做外框，那麼 catch 是落在 fn 本體身上。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;error.json&#x27;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(response);<span class="comment">//獲得一個完整 response 物件</span></span><br><span class="line">  <span class="keyword">let</span> user = <span class="keyword">await</span> response.<span class="title function_">json</span>(); <span class="comment">//取得失敗</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fn</span>().<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(err); <span class="comment">// SyntaxError: Unexpected token &lt; in JSON at position 0</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>總結來說：</p>
<ol>
<li>使用 async&#x2F;await 時，就不太會去使用 then()</li>
<li>常態性使用 try-catch，撰寫上的流程會比較直白些。</li>
<li>await 必需要在 async 內，才能有作用。</li>
<li>要等待某一個結果請使用 await 放在函式或建構式前面，程式會等他完成才往下跑。</li>
<li>前綴有 async 的函式能代表他將會回傳 promise 物件需要等待。</li>
<li>async&#x2F;await 可以取代 promise.then&#x2F;catch，但事實上他也是 promise 的語法。</li>
</ol>
<h1 id="API-串接"><a href="#API-串接" class="headerlink" title="API 串接"></a>API 串接</h1><p>應用程式介面（Application Programming Interface）簡稱為 API 是個通俗的名稱，拿來解釋不同的軟體之間的溝通橋樑。透過請求 Request 與 Response 回應來完成資料的交換指令。在網頁上主要是前端與伺服器的溝通方式。透過 API 的指定網址與 Request 之 HTML 協定來進行溝通。</p>
<p>全名 Hypertext Transfer Protocol（超文本傳輸協定），每次進行網頁發送 request 請求時，伺服器端會檢查網址存在後，回發送 response 給你。這就是 HTTP 協定。如果網址不存在則會發送 404 的錯誤畫面給你（或其他因素提供對應的 HTTP response code 狀態碼）。</p>
<p>狀態碼大致可以分為五大類：</p>
<ul>
<li>資訊回應 (Informational responses, 100–199),</li>
<li>成功回應 (Successful responses, 200–299),</li>
<li>重定向 (Redirects, 300–399),</li>
<li>用戶端錯誤 (Client errors, 400–499),</li>
<li>伺服器端錯誤 (Server errors, 500–599).<blockquote>
<p>更多細節請查看 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7231">RFC 7231</a> 規範</p>
</blockquote>
</li>
</ul>
<p>例如用 PHP 來宣告本頁的 response statue code 為 404，即使有畫面資料，透過 Ajax 抓取會得到 404 結果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>];</span><br><span class="line"><span class="title function_ invoke__">http_response_code</span>(<span class="number">404</span>);</span><br></pre></td></tr></table></figure>

<p>然而要進行請求時，根據 HTML 協定的 method 歸類可以分為 GET（查詢） &#x2F; POST（新增） &#x2F; PUT（修改） &#x2F; DELETE（刪除）為主，也就是對應了 CRUD 行為請求之觀念。在沒有聊到 RESTful 觀念之前，API 串接方式沒有一定方式，主要是看伺服器要如何接手你的 request（包含判別 GET&#x2F;POST&#x2F;PUT&#x2F;DELETE）來進行怎樣的動作自己規定。</p>
<h2 id="RESTful"><a href="#RESTful" class="headerlink" title="RESTful"></a>RESTful</h2><p>真正的名字應該稱呼為 REST(Representational State Transfer) 表現層狀態轉換。是一種風格做法而不是一個標準。而 RESTful 只是一個形容詞（就像 beautiy-&gt;beautiful)，只要符合這種做法都可以稱呼這個 API 有遵循 REST 機制做法，是屬於 Restful API 的設計。</p>
<p>符合 REST 設計風格的 Web API 稱為 RESTful API。它從以下三個方面資源進行定義：</p>
<ul>
<li>直觀簡短的資源 URI 位址，例如：<code>http://demo.com/api</code>。</li>
<li>傳輸的資源：Web 服務接受與返回的網際網路媒體類型，比如：JSON, XML, YAML 等。</li>
<li>對資源的操作：Web 服務在該資源上所支援的一系列請求方法（例如：POST, GET, PUT, DELETE…）共 8 種。</li>
</ul>
<p>與傳統 API 來比較，可能普通 API 的請求 URI 位置舉例如下：</p>
<ul>
<li>取得：<code>http://demo.com/api/get/</code> </li>
<li>新增：<code>http://demo.com/api/post/</code> </li>
<li>更新：<code>http://demo.com/api/update/3</code> </li>
<li>刪除：<code>http://demo.com/api/delete/3</code></li>
</ul>
<p>至於 RESTful API 的規則舉例如下：</p>
<ul>
<li>取得：<code>http://demo.com/api/</code> + HTTP Method GET</li>
<li>新增：<code>http://demo.com/api/</code> + HTTP Method POST</li>
<li>更新：<code>http://demo.com/api/3</code> + HTTP Method PUT</li>
<li>刪除：<code>http://demo.com/api/3</code> + HTTP Method DELETE</li>
</ul>
<p>也就是 URI 只有一個，有任何 Verbs 資源動作都寫在 Method 裡面。而 URI 這裡指的是（Uniform Resource Identifier）統一資源識別符號，也就是某檔案路徑下的資源所在之請求位置。另外說明 URL 為 Uniform Resource Locatin 指的是一個檔案路徑。所以 URL 的後面多一個動作行為就能拿來視為 URI。規劃極簡的 URI 也是 REST 要求的重點之一，這需要透過路由或 apache 的 htaccess 重寫規則來轉換。</p>
<p>規則可以在細分一點，舉例為文章清單應用：</p>
<ul>
<li><code>GET http://demo.com/page/</code> 瀏覽全部文章</li>
<li><code>GET http://demo.com/page/1</code> 瀏覽單筆文章且 ID 為 1</li>
<li><code>POST http://demo.com/page/</code> 新增一筆文章</li>
<li><code>PATCH http://demo.com/page/1</code> 修改單筆文章且 ID 為 1</li>
<li><code>PUT http://demo.com/page/1</code> 修改單筆文章且 ID 為 1，若尚未建立則為新增</li>
<li><code>DELETE http://demo.com/page/</code> 刪除單筆文章 ID 為 1</li>
</ul>
<p>RESTful 不是一定的規定，可以混搭自己需要的路由操作目標。譬如可以<code>DELETE http://demo.com/page/login</code>做登入驗證請求。RESTful 只是將 CRUD 的方式做一下習慣建議。在 Ajax 應用當中都有提供所有有 Method 方式，而後端需要判別時可透過偵測 requst method 方式為何，部分處理若不會有回應內容時，可 response 下達 ststus code（例如 202 為 no content)。舉例 PHP 來說：</p>
<figure class="highlight php"><figcaption><span>php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="comment">//PHP 能直接對$_GET 與$_POST 做存取，其他則需要透過 request method 查找</span></span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>]) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">    <span class="comment"># code...</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">    <span class="comment"># code...</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;PUT&#x27;</span>:</span><br><span class="line">    <span class="variable">$_PUT</span> = <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>), <span class="literal">true</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$_PUT</span>);</span><br><span class="line">    <span class="comment">//如果 PUT 已新增資源，則提供代碼 201 (Created) 通知用戶代理</span></span><br><span class="line">    <span class="comment">//如果修改了現有資源，則應發送 200 (OK) 或 204 (No Content）以指示請求已成功完成。</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;DELETE&#x27;</span>:</span><br><span class="line">    <span class="variable">$_DELETE</span> = <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>), <span class="literal">true</span>);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$_DELETE</span>);</span><br><span class="line">    <span class="title function_ invoke__">http_response_code</span>(<span class="number">202</span>); <span class="comment">//no content</span></span><br><span class="line">    <span class="comment">// 需 resopnse 內容回去則提供 200</span></span><br><span class="line">    <span class="comment">// 處理中已加入排程提供 202 (Accepted)</span></span><br><span class="line">    <span class="comment">// 沒有 response 內容回去則為 204</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="OpenData-API"><a href="#OpenData-API" class="headerlink" title="OpenData API"></a>OpenData API</h2><p>國內提供非常多元的免費 API 串接，也就是 OpenData 讓你直接用。大也不是啥都能順利套用以及保持更新。所以在找到任何 API 來源時推薦先驗證測試使用。以下推三種方法來做 API 測試：</p>
<h3 id="測試方式"><a href="#測試方式" class="headerlink" title="測試方式"></a>測試方式</h3><ul>
<li>Postman REST Client<br>算是很多人使用的方式，<a target="_blank" rel="noopener" href="https://www.postman.com/product/rest-client/">免費下載</a> 提供使用，網路資源很多不多介紹。</li>
<li>VSCode Plugin-REST Client<br><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=humao.rest-client">REST Client</a> 直接在 VSCode 就能測試，你需要先建立一個<code>檔名。http</code>並貼上 Request 之 URL 會自動生成提示 Send Request 之字眼按下送出即可。會產生 Response 資訊與內容方便文字複製。若需其他 REST Method 可在網址前綴補上關鍵字如下：<figure class="highlight http"><figcaption><span>demo.http</span></figcaption><table><tr><td class="code"><pre><span class="line">GET https://tw.rter.info/capi.php</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="CORS-問題與解決"><a href="#CORS-問題與解決" class="headerlink" title="CORS 問題與解決"></a>CORS 問題與解決</h3><p>在使用 API 進行溝通時尤其對外部 OpenData API 請求時，有機會發生錯誤訊息。</p>
<blockquote>
<p>has been blocked by CORS policy: No ‘Access-Control-Allow-Origin’ header is present on the requested resource. If an opaque response serves your needs, set the request’s mode to ‘no-cors’ to fetch the resource with CORS disabled.</p>
</blockquote>
<p>這是用戶的瀏覽器在執行時根據 W3C 規範而阻止你做了這樣的事情，當 JS 指令需要跟某伺服器請求時，根據同源政策 (Same Origin Policy) 下只有同 domain 的資源才可相互存取防範駭客攻擊。如果是自家後端的伺服器要開放允許很簡單，舉例 PHP 來說只需要設定以下開頭宣告即可：</p>
<figure class="highlight php"><figcaption><span>apiService.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Access-Control-Allow-Origin:*&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="伺服器開放-CORS"><a href="#伺服器開放-CORS" class="headerlink" title="伺服器開放 CORS"></a>伺服器開放 CORS</h3><p>因此當你碰到 API 請求失敗時，很大因素是對方工程師沒有特別開放給任何人連線。除非你有能力要求對方全面開放或額外開放指定你的網頁 Domain 能請求：</p>
<figure class="highlight php"><figcaption><span>apiService.php</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 僅授權讓 demo.com 網域來存取資源</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_ORIGIN&#x27;</span>] == <span class="string">&quot;http://demo.com&quot;</span>) &#123;</span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Access-Control-Allow-Origin: http://demo.com&#x27;</span>);</span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type: application/json&#x27;</span>);</span><br><span class="line">  <span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;data.json&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html&#x27;</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;本 API 僅授權 &lt;b&gt;&#x27;http://demo.com&#x27;&lt;/b&gt; 使用，其他拜訪來源將禁止存取&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="透過-PHP-存取"><a href="#透過-PHP-存取" class="headerlink" title="透過 PHP 存取"></a>透過 PHP 存取</h3><p>同上話題，你應該沒有那能力去要求提供 OpenData 服務商開放，所以大部分的人都會用爬蟲方式來取得。可幸的是只有 JS 的 Ajax 會被阻擋，反而 PHP, python,Node.js 這些後端程式都可以正常存取別人的 API(Postman 也是）。簡單來說就是爬蟲方法，以下舉例 PHP 兩種 API 存取方式。</p>
<ul>
<li>file_get_contents<br> 適合存取資料量少且更新不頻繁的對象，整體上效能低資源吃重。但相對語法上簡單就能完成。<figure class="highlight php"><figcaption><span>file_get_content</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;https://tw.rter.info/capi.php&#x27;</span>);</span><br><span class="line"><span class="variable">$data1</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$content</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$data1</span>);</span><br></pre></td></tr></table></figure></li>
<li>curl<br>因有提供暫存功能，適合資料量大且整體運作效能高，更包含多種參數可特別使用。如果允許請盡量使用 CURL 方式存取。<figure class="highlight php"><figcaption><span>curl</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">load_contents</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>(); <span class="comment">// 初始化 CURL</span></span><br><span class="line">  <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>); <span class="comment">//回傳移除，預設 false: 自動輸出至畫面。true 則不輸出（可繼續編輯處理變數）</span></span><br><span class="line">  <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>); <span class="comment">//目標網址</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/****************************************************************非必要的設定</span></span><br><span class="line"><span class="comment">  curl_setopt($ch, CURLOPT_HEADER, false); // 是否需取得 HEAD 資訊</span></span><br><span class="line"><span class="comment">  預設 TRUE 驗證伺服器憑證，拜訪 https 若未做任何 SSL 設定會出錯。</span></span><br><span class="line"><span class="comment">  curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  發出端的用戶代理，提供軟體類型、版本號、作業系統、開發者資訊。參考 https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Headers/User-Agent</span></span><br><span class="line"><span class="comment">  curl_setopt($curl, CURLOPT_USERAGENT, &quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.71 Safari/537.36&quot;);</span></span><br><span class="line"><span class="comment">   *******************************************************************/</span></span><br><span class="line"></span><br><span class="line">  <span class="variable">$data</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>); <span class="comment">// 執行 curl</span></span><br><span class="line">  <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>); <span class="comment">// 關閉 curl</span></span><br><span class="line">  <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">load_contents</span>(<span class="string">&#x27;https://tw.rter.info/capi.php&#x27;</span>);</span><br><span class="line"><span class="variable">$data2</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$content</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$data2</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>若你有能力自行建立伺服器當作跳板，用自家的後端去存取別人伺服器的資料回來，再讓同網域下（或特別開放）的前端 JS 向此處存取。</p>
<ul>
<li>透過第三方線上跳板 cors-anywhere<br>若沒有能力自己架設伺服器，<a target="_blank" rel="noopener" href="https://github.com/Rob--W/cors-anywhere">cors-anywhere</a> 提供專門解決 CORS 的免費伺服器跳板，根據使用方式說明只需設定以下代碼即可。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cors = <span class="string">&#x27;https://cors-anywhere.herokuapp.com/&#x27;</span>; <span class="comment">// use cors-anywhere to fetch api data</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">&#x27;https://tw.rter.info/capi.php&#x27;</span>; <span class="comment">// origin api url</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">`<span class="subst">$&#123;cors&#125;</span><span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">json</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(json))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Error:&#x27;</span>, error));</span><br></pre></td></tr></table></figure>

<h3 id="免費-OpenData-平台"><a href="#免費-OpenData-平台" class="headerlink" title="免費 OpenData 平台"></a>免費 OpenData 平台</h3><ul>
<li><a target="_blank" rel="noopener" href="https://tw.rter.info/howto_currencyapi.php">全球即時匯率 API</a> CORS</li>
<li><a target="_blank" rel="noopener" href="https://opendata.cwb.gov.tw/index">氣象開放資料平臺</a></li>
<li><a target="_blank" rel="noopener" href="https://data.gov.tw/">政府資料開放平臺</a></li>
<li><a target="_blank" rel="noopener" href="https://ptx.transportdata.tw/PTX/">公共運輸整合資訊流通服務平台</a></li>
</ul>
<h1 id="參考文獻"><a href="#參考文獻" class="headerlink" title="參考文獻"></a>參考文獻</h1><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/API/Fetch_API">Fetch API - Web APIs | MDN</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch">WorkerOrGlobalScope.fetch() - Web API 接口参考 | MDN</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API/Using_Fetch">使用 Fetch - Web API 接口参考 | MDN</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/HTTP/CORS">跨來源資源共用（CORS） - HTTP | MDN</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Request">Request - Web API 接口参考 | MDN</a><br><a target="_blank" rel="noopener" href="https://www.kancloud.cn/liweiliang/axios/1328148">使用说明 · Axios 中文说明 · 看云</a><br><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/articles/10212120">axios  基本使用 &amp; Config - iT 邦幫忙：: 一起幫忙解決難題，拯救 IT 人的一天</a><br><a target="_blank" rel="noopener" href="http://promise.eddychang.me/docs/contents/ch3_promise_a_plus/">從 Promise 開始的 JavaScript 異步生活</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/30008114/how-do-i-promisify-native-xhr">stackoverflow- chaining multiple XHR calls </a><br><a target="_blank" rel="noopener" href="https://zh.javascript.info/async">Promise，async&#x2F;await</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Promise">MDN-Promise</a><br><a target="_blank" rel="noopener" href="https://www.sitepoint.com/xmlhttprequest-vs-the-fetch-api-whats-best-for-ajax-in-2019/">XMLHttpRequest vs the Fetch API for Ajax - SitePoint</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
              <a href="/tags/jQuery/" rel="tag"># jQuery</a>
              <a href="/tags/axios/" rel="tag"># axios</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/12-01/article-htmlcssjs-plus/" rel="prev" title="[學習之路] 重新認識你知道的 HTML、CSS、JavaScript">
                  <i class="fa fa-chevron-left"></i> [學習之路] 重新認識你知道的 HTML、CSS、JavaScript
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/12-30/article-nodejs/" rel="next" title="[學習之路] Node.js 入門教學">
                  [學習之路] Node.js 入門教學 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  
      <span class="post-meta-item">
        <span class="post-meta-item-icon with-love">
          <i class="fa fa-chart-line"></i>
        </span>
        <span title="全站總字數">519,531</span>
      </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon with-love">
          <i class="fa fa-coffee"></i>
        </span>
        <span title="全站總閱讀時間">15:44:36</span>
      </span>
      <span class="post-meta-item" id="busuanzi_container_site_uv">
        <span class="post-meta-item-icon with-love">
          <i class="fa fa-user"></i>
        </span>
        <span class="site-uv" title="訪客總數">
          <span id="busuanzi_value_site_uv"></span>
        </span>
      </span>
      <span class="post-meta-item" id="busuanzi_container_site_pv">
        <span class="post-meta-item-icon with-love">
          <i class="fa fa-eye"></i>
        </span>
        <span class="site-pv" title="總瀏覽次數">
          <span id="busuanzi_value_site_pv"></span>
        </span>
      </span>

    <div class="copyright">
      <span class="with-love">
        <i class="fa fa-star"></i>
      </span>
      <span class="author" itemprop="copyrightHolder" title="找我？！側單左上連結">Loki Jiang</span>
      <span class="post-meta-item-icon with-love">
        <i class="fas fa-copyright"></i>
      </span>
      2020 – 
      <span itemprop="copyrightYear">2023</span> All rights reserved.
    </div>
  
    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/summer10920" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.4.3/mermaid.min.js","integrity":"sha256-e0o3JYsdjqKajf9eOe22FhioYSz9WofRY4dLKo3F6do="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>



  
  
  <script>
    var bszCaller,
      bszTag;
    !function () {
      var c,
        d,
        e,
        a = !1,
        b = [];
      ready = function (c) {
        return a || "interactive" === document.readyState || "complete" === document.readyState
          ? c.call(document)
          : b.push(function () {
            return c.call(this)
          }),
        this
      },
      d = function () {
        for (var a = 0, c = b.length; c > a; a++) 
          b[a].apply(document);
        b = []
      },
      e = function () {
        a || (
          a = !0, d.call(window), document.removeEventListener
          ? document.removeEventListener("DOMContentLoaded", e, !1)
          : document.attachEvent && (document.detachEvent("onreadystatechange", e), window == window.top && (clearInterval(c), c = null)))
      },
      document.addEventListener
        ? document.addEventListener("DOMContentLoaded", e, !1)
        : document.attachEvent && (document.attachEvent("onreadystatechange", function () {
          /loaded|complete/.test(document.readyState) && e()
        }), window == window.top && (c = setInterval(function () {
          try {
            a || document
              .documentElement
              .doScroll("left")
          } catch (b) {
            return
          }
          e()
        }, 5)))
    }(),
    bszCaller = {
      fetch: function (a, b) {
        var c = "BusuanziCallback_" + Math.floor(1099511627776 * Math.random());
        window[c] = this.evalCall(b),
        a = a.replace("=BusuanziCallback", "=" + c),
        scriptTag = document.createElement("SCRIPT"),
        scriptTag.type = "text/javascript",
        scriptTag.defer = !0,
        scriptTag.src = a,
        scriptTag.referrerPolicy = "no-referrer-when-downgrade",
        document
          .getElementsByTagName("HEAD")[0]
          .appendChild(scriptTag)
      },
      evalCall: function (a) {
        return function (b) {
          ready(function () {
            try {
              a(b),
              scriptTag
                .parentElement
                .removeChild(scriptTag)
            } catch (c) {
              bszTag.hides()
            }
          })
        }
      }
    },
    bszCaller.fetch("//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback", function (a) {
      bszTag.texts(a),
      bszTag.shows()
    }),
    bszTag = {
      bszs: [
        "site_pv", "page_pv", "site_uv"
      ],
      texts: function (a) {
        this
          .bszs
          .map(function (b) {
            var c = document.getElementById("busuanzi_value_" + b);
            c && (c.innerHTML = a[b].toLocaleString())
          })
      },
      hides: function () {
        this
          .bszs
          .map(function (a) {
            var b = document.getElementById("busuanzi_container_" + a);
            b && (b.style.display = "none")
          })
      },
      shows: function () {
        this
          .bszs
          .map(function (a) {
            var b = document.getElementById("busuanzi_container_" + a);
            b && (b.style.display = "inline")
          })
      }
    };
  </script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"
    integrity="sha512-lGnVsh3WK0YJ7NX7rQmUu6kqF7vqELuDrUTnxpI2iD86VwI+OlQhi3EAJJZbrBUOfDFOAYAkigxkApHGM2IZTg=="
    crossorigin="anonymous"></script>
<script src="/js/loki.js"></script>

</body>
</html>
