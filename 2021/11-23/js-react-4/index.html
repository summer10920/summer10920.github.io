<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo-loki.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,400,400italic,700,700italic%7CNoto+Sans+TC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"summer10920.github.io","root":"/","images":"/images","scheme":"Muse","version":"8.7.0","exturl":false,"sidebar":{"position":"left","width":400,"display":"post","padding":20,"offset":20},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="本篇開始深入探討一些 React 細節高級操作觀念上的的認知學習單元，根據參考官方手冊逐步學習。同時會略過一些對於未來性將捨棄的原有功能。">
<meta property="og:type" content="article">
<meta property="og:title" content="[學習之路] JS 前端框架 React - 高級">
<meta property="og:url" content="http://summer10920.github.io/2021/11-23/js-react-4/">
<meta property="og:site_name" content="洛奇的邪惡組織手札">
<meta property="og:description" content="本篇開始深入探討一些 React 細節高級操作觀念上的的認知學習單元，根據參考官方手冊逐步學習。同時會略過一些對於未來性將捨棄的原有功能。">
<meta property="og:locale" content="zh_TW">
<meta property="og:image" content="https://i.imgur.com/iWnyS9n.png">
<meta property="og:image" content="https://i.imgur.com/FRyCjho.png">
<meta property="og:image" content="https://i.imgur.com/6PFkhRX.png">
<meta property="og:image" content="https://i.imgur.com/hvPOp7M.png">
<meta property="article:published_time" content="2021-11-23T05:24:56.000Z">
<meta property="article:modified_time" content="2021-12-10T17:53:12.867Z">
<meta property="article:author" content="Loki Jiang">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="ReactJS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.imgur.com/iWnyS9n.png">


<link rel="canonical" href="http://summer10920.github.io/2021/11-23/js-react-4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"http://summer10920.github.io/2021/11-23/js-react-4/","path":"2021/11-23/js-react-4/","title":"[學習之路] JS 前端框架 React - 高級"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>[學習之路] JS 前端框架 React - 高級 | 洛奇的邪惡組織手札</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146423952-3"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-146423952-3","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>



<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&family=Roboto&display=swap" rel="stylesheet">
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <canvas id="lokiBanner" width="1920" height="200"></canvas>
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">洛奇的邪惡組織手札</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">I am WebDeveloper!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤<span class="badge">19</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類<span class="badge">15</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>文章<span class="badge">62</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜尋
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜尋..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          關於洛奇
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B7%B1%E5%85%A5-JSX"><span class="nav-number">1.</span> <span class="nav-text">深入 JSX</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A8%98%E9%BB%9E%E6%B3%95%E8%88%87%E6%8B%AC%E5%BC%A7%E8%A8%98%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">記點法與括弧記法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E8%A8%82%E7%B5%84%E4%BB%B6%E7%82%BA%E5%A4%A7%E5%AF%AB"><span class="nav-number">1.2.</span> <span class="nav-text">自訂組件為大寫</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#props-%E8%A6%8F%E5%89%87"><span class="nav-number">1.3.</span> <span class="nav-text">props 規則</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E9%81%94%E5%BC%8F"><span class="nav-number">1.3.1.</span> <span class="nav-text">表達式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E4%B8%B2%E8%88%87%E5%B8%83%E6%9E%97%E5%80%BC"><span class="nav-number">1.3.2.</span> <span class="nav-text">字串與布林值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%95%E9%96%8B%E9%81%8B%E7%AE%97%E5%AD%90-Spread-syntax-%E8%88%87-%E8%A7%A3%E6%A7%8B-destructuring"><span class="nav-number">1.3.3.</span> <span class="nav-text">展開運算子 Spread syntax 與 解構 destructuring</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#props-children"><span class="nav-number">1.4.</span> <span class="nav-text">props.children</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A2%E7%8B%80"><span class="nav-number">1.4.1.</span> <span class="nav-text">巢狀</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E9%81%94%E5%BC%8F-1"><span class="nav-number">1.4.2.</span> <span class="nav-text">表達式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#callback-children"><span class="nav-number">1.4.3.</span> <span class="nav-text">callback children</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%BD%E7%95%A5%E7%9A%84-children"><span class="nav-number">1.4.4.</span> <span class="nav-text">忽略的 children</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Portal-children-%E5%82%B3%E9%80%81"><span class="nav-number">1.4.5.</span> <span class="nav-text">Portal children 傳送</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%82%B3%E9%80%81%E5%8C%85%E5%90%AB-Event-Bubbling"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">傳送包含 Event Bubbling</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A2%BC%E5%88%86%E5%89%B2"><span class="nav-number">2.</span> <span class="nav-text">代碼分割</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8B%95%E6%85%8B-import"><span class="nav-number">2.1.</span> <span class="nav-text">動態 import()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%84%AA%E5%8C%96%E8%BC%89%E5%85%A5-React-Suspense-amp-React-Lazy"><span class="nav-number">2.2.</span> <span class="nav-text">優化載入 React Suspense &amp; React Lazy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#React-lazy"><span class="nav-number">2.2.1.</span> <span class="nav-text">React.lazy()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Suspense"><span class="nav-number">2.2.2.</span> <span class="nav-text">React.Suspense</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%BD%E5%8F%96%E4%BE%86%E8%87%AA-named-export"><span class="nav-number">2.2.3.</span> <span class="nav-text">抽取來自 named export</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Context"><span class="nav-number">3.</span> <span class="nav-text">Context</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#class-%E7%9A%84-Context"><span class="nav-number">3.1.</span> <span class="nav-text">class 的 Context</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#API-%E7%9B%B8%E9%97%9C%E8%AA%AA%E6%98%8E"><span class="nav-number">3.1.1.</span> <span class="nav-text">API 相關說明</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#React-createContext"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">React.createContext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Context-Provider"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">Context.Provider</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Class-contextType"><span class="nav-number">3.1.1.3.</span> <span class="nav-text">Class.contextType</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Context-Consumer"><span class="nav-number">3.1.1.4.</span> <span class="nav-text">Context.Consumer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Context-displayName"><span class="nav-number">3.1.1.5.</span> <span class="nav-text">Context.displayName</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AF%84%E4%BE%8B%EF%BC%9A%E5%8F%AF%E8%AE%8A%E7%9A%84-Context"><span class="nav-number">3.1.2.</span> <span class="nav-text">範例：可變的 Context</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8-Context-%E7%9A%84%E6%9B%BF%E4%BB%A3%E6%96%B9%E6%A1%88"><span class="nav-number">3.2.</span> <span class="nav-text">不使用 Context 的替代方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hook-%E7%9A%84-Context"><span class="nav-number">3.3.</span> <span class="nav-text">hook 的 Context</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ref"><span class="nav-number">4.</span> <span class="nav-text">ref</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%91-DOM-%E5%85%83%E7%B4%A0%E6%B7%BB%E5%8A%A0-Ref"><span class="nav-number">4.1.</span> <span class="nav-text">向 DOM 元素添加 Ref</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Class-%E7%B5%84%E4%BB%B6-%E7%9A%84-ref"><span class="nav-number">4.1.1.</span> <span class="nav-text">Class 組件 的 ref</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#function-%E7%B5%84%E4%BB%B6-%E7%9A%84-ref"><span class="nav-number">4.1.2.</span> <span class="nav-text">function 組件 的 ref</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%91%E4%B8%8B%E5%B1%A4-Class-Component-%E6%B7%BB%E5%8A%A0-Ref"><span class="nav-number">4.2.</span> <span class="nav-text">向下層 Class Component 添加 Ref</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Callback-Refs"><span class="nav-number">4.3.</span> <span class="nav-text">Callback Refs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%82%B3%E9%80%81-Ref"><span class="nav-number">4.4.</span> <span class="nav-text">傳送 Ref</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%96%8B%E7%99%BC%E5%B7%A5%E5%85%B7%E4%B8%8A%E7%9A%84%E5%AE%A2%E8%A3%BD%E5%8C%96%E5%90%8D%E7%A8%B1"><span class="nav-number">4.4.1.</span> <span class="nav-text">開發工具上的客製化名稱</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-1%EF%BC%9A%E6%8F%90%E4%BE%9B%E5%85%B7%E5%90%8D%E5%87%BD%E5%BC%8F"><span class="nav-number">4.4.1.1.</span> <span class="nav-text">方法 1：提供具名函式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-2%EF%BC%9A%E9%80%8F%E9%81%8E%E5%85%B7%E5%90%8D%E5%87%BD%E5%BC%8F%E5%A2%9E%E5%8A%A0-displayName-%E7%89%A9%E4%BB%B6%E5%B1%AC%E6%80%A7"><span class="nav-number">4.4.1.2.</span> <span class="nav-text">方法 2：透過具名函式增加 displayName 物件屬性</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Loki Jiang"
      src="/images/loki_img.jpg">
  <p class="site-author-name" itemprop="name">Loki Jiang</p>
  <div class="site-description" itemprop="description">Time waits for no oneヽ(｀Д´)ﾉ</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">62</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/summer10920" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;summer10920" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:summer10920@gmail.com" title="E-Mail → mailto:summer10920@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://codepen.io/summer10920/pens/public?grid_type=list" title="CodePen → https:&#x2F;&#x2F;codepen.io&#x2F;summer10920&#x2F;pens&#x2F;public?grid_type&#x3D;list" rel="noopener" target="_blank"><i class="fab fa-codepen fa-fw"></i>CodePen</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.youtube.com/c/LokiJiang/playlists" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;c&#x2F;LokiJiang&#x2F;playlists" rel="noopener" target="_blank"><i class="fab fa-youtube fa-fw"></i>YouTube</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      其他資源
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://demob17300.lokiui.com/" title="http:&#x2F;&#x2F;demob17300.lokiui.com&#x2F;" rel="noopener" target="_blank">DemoSite - 網頁設計乙術科</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://blog.lokiui.com/" title="http:&#x2F;&#x2F;blog.lokiui.com&#x2F;" rel="noopener" target="_blank">舊址(停更) - 札記 Blog</a>
        </li>
    </ul>
  </div>

          </div>
        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="回到頂端">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
          <div class="lokiFull"></div>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/summer10920" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="http://summer10920.github.io/2021/11-23/js-react-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/loki_img.jpg">
      <meta itemprop="name" content="Loki Jiang">
      <meta itemprop="description" content="Time waits for no oneヽ(｀Д´)ﾉ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="洛奇的邪惡組織手札">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [學習之路] JS 前端框架 React - 高級
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>

      <time title="創建時間 ×2021-11-23 13:24:56" itemprop="dateCreated datePublished" datetime="2021-11-23T13:24:56+08:00">2021-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新於</span>
        <time title="修改時間 ×2021-12-11 01:53:12" itemprop="dateModified" datetime="2021-12-11T01:53:12+08:00">2021-12-11</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Zero-Road/" itemprop="url" rel="index"><span itemprop="name">Zero Road</span></a>
        </span>
          , 
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Zero-Road/ReactJS/" itemprop="url" rel="index"><span itemprop="name">ReactJS</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數 ×</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="文章字數">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">文章字數 ×</span>
      <span>35073 <i>words</i></span>
    </span>
    <span class="post-meta-item" title="所需閱讀時間">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">所需閱讀時間 &asymp;</span>
      <span>64 <i>mins</i></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><img src="https://i.imgur.com/iWnyS9n.png"><br>本篇開始深入探討一些 React 細節高級操作觀念上的的認知學習單元，根據參考官方手冊逐步學習。同時會略過一些對於未來性將捨棄的原有功能。</p>
<span id="more"></span>
<h1 id="深入-JSX"><a href="#深入-JSX" class="headerlink" title="深入 JSX"></a>深入 JSX</h1><p>基本上 JSX 單純只是 React.createElement(component, props, …children) 函式 API 的產物語法糖。假設 JSX 程式碼如下則 React 會自動編譯成：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;MyButton color=<span class="string">&quot;blue&quot;</span> shadowSize=&#123;<span class="number">2</span>&#125;&gt;</span><br><span class="line">  Click Me</span><br><span class="line">&lt;/MyButton&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******react complier*****/</span></span><br><span class="line">React.createElement(</span><br><span class="line">  MyButton,</span><br><span class="line">  &#123;<span class="attr">color</span>: <span class="string">&#x27;blue&#x27;</span>, <span class="attr">shadowSize</span>: <span class="number">2</span>&#125;,</span><br><span class="line">  <span class="string">&#x27;Click Me&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>如果是沒有 prop.children 的結尾標籤寫法則為：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div className=<span class="string">&quot;sidebar&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/******react complier*****/</span></span><br><span class="line">React.createElement(</span><br><span class="line">  <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">  &#123;<span class="attr">className</span>: <span class="string">&#x27;sidebar&#x27;</span>&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>因此如果環境上無法使用 JSX，可能是缺少宣告<code>import React from &#39;react&#39;</code>，才能讓 React 使用 React.createElement()。</p>
<h2 id="記點法與括弧記法"><a href="#記點法與括弧記法" class="headerlink" title="記點法與括弧記法"></a>記點法與括弧記法</h2><p>攤開 JSX 的原理後，你也可以用物件導向的方式去使用記點法 Dot notation 來代表一個組件來源：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyComponents = &#123;</span><br><span class="line">  <span class="attr">DatePicker</span>: <span class="function"><span class="keyword">function</span> <span class="title">DatePicker</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Imagine a &#123;props.color&#125; datepicker here.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BlueDatePicker</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">MyComponents.DatePicker</span> <span class="attr">color</span>=<span class="string">&quot;blue&quot;</span> /&gt;</span></span>; <span class="comment">//記點法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但要注意，不能使用括弧記法 Bracket notation 來代表一個組件來源寫在 JSX 內，除非先使用賦值一個大寫變數來做代替。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; PhotoStory, VideoStory &#125; <span class="keyword">from</span> <span class="string">&#x27;./stories&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = &#123;</span><br><span class="line">  <span class="attr">photo</span>: PhotoStory,</span><br><span class="line">  <span class="attr">video</span>: VideoStory</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Story</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 錯誤！JSX 不能是表達式。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml">&lt;components[props.storyType] story=&#123;props.story&#125; /&gt;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Story</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 正確！JSX 類型可以是大寫字母開頭的變數。</span></span><br><span class="line">  <span class="keyword">const</span> SpecificStory = components[props.storyType];</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SpecificStory</span> <span class="attr">story</span>=<span class="string">&#123;props.story&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自訂組件為大寫"><a href="#自訂組件為大寫" class="headerlink" title="自訂組件為大寫"></a>自訂組件為大寫</h2><p>由於可能會傳遞組件或元素給 createElement API，因此為了區分他組件命名都是強迫大寫開頭為規則：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正確！這是一個 component 並且應該由大寫字母開頭：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 正確！因為 div 是一個有效的 HTML 標籤，所以使用 &lt;div&gt; 是可行的：</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;props.toWhat&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HelloWorld</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 正確！React 會因為大寫字母開頭而了解 &lt;Hello /&gt; 是一個 component。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Hello</span> <span class="attr">toWhat</span>=<span class="string">&quot;World&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="props-規則"><a href="#props-規則" class="headerlink" title="props 規則"></a>props 規則</h2><h3 id="表達式"><a href="#表達式" class="headerlink" title="表達式"></a>表達式</h3><p>規劃 props 時，在{}內式可以使用 JavaScript 表達式的：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;MyComponent foo=&#123;<span class="number">1</span> + <span class="number">2</span> + <span class="number">3</span> + <span class="number">4</span>&#125; /&gt;</span><br><span class="line"><span class="comment">// props.foo=10</span></span><br></pre></td></tr></table></figure>

<p>而像 if 或迴圈這類，雖然不是表達式也可以先執行再帶入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NumberDescriber</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> description;</span><br><span class="line">  <span class="keyword">if</span> (props.number % <span class="number">2</span> == <span class="number">0</span>) description = <span class="xml"><span class="tag">&lt;<span class="name">strong</span>&gt;</span>even<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span>;</span><br><span class="line">  <span class="keyword">else</span> description = <span class="xml"><span class="tag">&lt;<span class="name">i</span>&gt;</span>odd<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;props.number&#125; is an &#123;description&#125; number<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="字串與布林值"><a href="#字串與布林值" class="headerlink" title="字串與布林值"></a>字串與布林值</h3><p>字串上在{}可以省略符號，同時也支援正規表達式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;MyComponent message=<span class="string">&quot;hello world&quot;</span> /&gt;</span><br><span class="line"><span class="comment">//same as</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">message</span>=<span class="string">&#123;</span>&#x27;<span class="attr">hello</span> <span class="attr">world</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">message</span>=<span class="string">&quot;<span class="symbol">&amp;lt;</span>3&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">//same as</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">message</span>=<span class="string">&#123;</span>&#x27;&lt;<span class="attr">3</span>&#x27;&#125; /&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>布林值的初始狀態，如果你沒給 prop 賦值，那麼它的預設值就是 true。但不建議這樣偷懶，因為這跟 ES6 的物件縮寫 object shorthand 觀念衝突，例如 {foo} 是 {foo: foo} 的簡寫而不是 {foo: true}：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;MyTextBox autocomplete /&gt;</span><br><span class="line"><span class="comment">//same as</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyTextBox</span> <span class="attr">autocomplete</span>=<span class="string">&#123;true&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="展開運算子-Spread-syntax-與-解構-destructuring"><a href="#展開運算子-Spread-syntax-與-解構-destructuring" class="headerlink" title="展開運算子 Spread syntax 與 解構 destructuring"></a>展開運算子 Spread syntax 與 解構 destructuring</h3><p>JavaScript 的展開運算子 (…) 應用也能適用在 props 上使用對 JSX 指定多筆屬性：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Greeting</span> <span class="attr">firstName</span>=<span class="string">&quot;Ben&quot;</span> <span class="attr">lastName</span>=<span class="string">&quot;Hector&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//same as</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> props = &#123;<span class="attr">firstName</span>: <span class="string">&#x27;Ben&#x27;</span>, <span class="attr">lastName</span>: <span class="string">&#x27;Hector&#x27;</span>&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Greeting</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>搭配物件解構 Object destructuring ，就能抽取不要的 props 屬性。以下為多層組件 App-&gt;Button-&gt;button 元素在傳遞 props 值。其中透過解構完成 2 件事：將 props.kind 換成指定的 props.className 值；抽取出 kind 後的 props 換成<code>...other</code>當作 button 的 props 屬性。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> Button = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; kind, ...other &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> className = kind === <span class="string">&quot;primary&quot;</span> ? <span class="string">&quot;PrimaryButton&quot;</span> : <span class="string">&quot;SecondaryButton&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span> &#123;<span class="attr">...other</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">kind</span>=<span class="string">&quot;primary&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> console.log(&quot;clicked!&quot;)&#125;&gt;</span></span><br><span class="line"><span class="xml">        Hello World!</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="props-children"><a href="#props-children" class="headerlink" title="props.children"></a>props.children</h2><p>使用 JSX 寫法時，若有開頭與結尾標籤之間則內容會成為特別的 props 屬性為 children 變數。以下為 JSX 對組件時的寫法，你會獲得 props.children 為 Hello world! 的字串值：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;MyComponent&gt;Hello world!&lt;<span class="regexp">/MyComponent&gt; /</span><span class="regexp">/ props.children=&#x27;Hello world!&#x27;;</span></span><br></pre></td></tr></table></figure>

<p>這跟 html 標籤邏輯相同，如果是對元素也適用，且同時 React 會自動清除空行，以下渲染結果都相同等價：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;Hello World&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  Hello World</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  Hello</span></span><br><span class="line"><span class="xml">  World</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  Hello World</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="巢狀"><a href="#巢狀" class="headerlink" title="巢狀"></a>巢狀</h3><p>也可以讓 chilren 提供更多組件或元素，跟 HTML 標籤觀念相同。以下都是合法 JSX 寫法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;MyContainer&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">MyFirstComponent</span> /&gt;</span></span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">MySecondComponent</span> /&gt;</span></span></span><br><span class="line">&lt;/MyContainer&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  Here is a list:</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Item 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>JSX 也能以陣列方式去渲染內容</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 沒有必要把多餘的 list items 包在 element 裡頭！</span></span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">// 別忘了加 keys</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;A&quot;</span>&gt;</span>First item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>,</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;B&quot;</span>&gt;</span>Second item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>,</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;C&quot;</span>&gt;</span>Third item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="表達式-1"><a href="#表達式-1" class="headerlink" title="表達式"></a>表達式</h3><p>在 children 內可以直接使用表達式獲得一個處理後的結果。以下兩者等價：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;MyComponent&gt;foo&lt;/MyComponent&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span>&gt;</span>&#123;&#x27;foo&#x27;&#125;<span class="tag">&lt;/<span class="name">MyComponent</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>將一個函式結果直接寫在 children 提供 render。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Item</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;props.message&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TodoList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> todos = [<span class="string">&#x27;finish doc&#x27;</span>, <span class="string">&#x27;submit pr&#x27;</span>, <span class="string">&#x27;nag dan to review&#x27;</span>];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;todos.map((message) =&gt; <span class="tag">&lt;<span class="name">Item</span> <span class="attr">key</span>=<span class="string">&#123;message&#125;</span> <span class="attr">message</span>=<span class="string">&#123;message&#125;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也能直接去引用任何變數當 children 一部分。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;props.addressee&#125;!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="callback-children"><a href="#callback-children" class="headerlink" title="callback children"></a>callback children</h3><p>children 當作一個 function 提供給下層組件使用 props.children，使 JSX 的延展操作更強大。只要 render 之前獲得結果提供 React 執行渲染即可。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// numTimes 次呼叫 children callback 來重複生成 component</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Repeat</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*props.children 為箭頭函式，如下</span></span><br><span class="line"><span class="comment">  (index) =&gt; &lt;div key=&#123;index&#125;&gt;This is item &#123;index&#125; in the list&lt;/div&gt;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> items = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; props.numTimes; i++) &#123;</span><br><span class="line">    items.push(props.children(i));</span><br><span class="line">    <span class="comment">//不斷塞入 &lt;div key=&#123;i&#125;&#125;&gt;This is item &#123;i&#125; in the list&lt;/div&gt;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;items&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>; <span class="comment">//傳遞連續 10 個小 div 之大 div 組合元素</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ListOfTenThings</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Repeat</span> <span class="attr">numTimes</span>=<span class="string">&#123;10&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;(index) =&gt; <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>This is item &#123;index&#125; in the list<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Repeat</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">ListOfTenThings</span> /&gt;</span></span></span><br><span class="line">  , <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">This is item 0 in the list</span></span><br><span class="line"><span class="comment">This is item 1 in the list</span></span><br><span class="line"><span class="comment">This is item 2 in the list</span></span><br><span class="line"><span class="comment">This is item 3 in the list</span></span><br><span class="line"><span class="comment">This is item 4 in the list</span></span><br><span class="line"><span class="comment">This is item 5 in the list</span></span><br><span class="line"><span class="comment">This is item 6 in the list</span></span><br><span class="line"><span class="comment">This is item 7 in the list</span></span><br><span class="line"><span class="comment">This is item 8 in the list</span></span><br><span class="line"><span class="comment">This is item 9 in the list</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="忽略的-children"><a href="#忽略的-children" class="headerlink" title="忽略的 children"></a>忽略的 children</h3><p>false, null, undefined, 與 true 都是有效的 children。它們只是單純不會被 render。以下結果相同：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div /&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;false&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;null&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;undefined&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;true&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>利用此特性，以下當變數 showHeader 為 true 時，會多渲染一個 Header 組件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &#123;showHeader &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Header</span> /&gt;</span></span>&#125;</span><br><span class="line">  &lt;Content /&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>如果你想要印出 false、true、null 或者 undefined 時，只能先轉為 string</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  My JavaScript variable is &#123;<span class="built_in">String</span>(myVariable)&#125;.</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Portal-children-傳送"><a href="#Portal-children-傳送" class="headerlink" title="Portal children 傳送"></a>Portal children 傳送</h3><p>props.children 的使用方式上，能將上層外部組件的子內容獲取至內部使用。舉例以下例子</p>
<ul>
<li>在 App 組件內規劃一個 on 按鈕並顯示一個 off 按鈕，且可觸發關閉此按鈕。</li>
<li>透過 state 狀態 showModal 來決定 on 按鈕下方是否顯示 off 按鈕。</li>
<li>Modal 組件會根據 props.children 從 App 那裏拿到 off 按鈕。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> appRoot = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app-root&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Modal</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;props.children&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [showModal, setShowModal] = useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> doShow = <span class="function">() =&gt;</span> setShowModal(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> doHide = <span class="function">() =&gt;</span> setShowModal(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> modal = showModal ? (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;doHide&#125;</span>&gt;</span>Hide modal<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line">  ) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;doShow&#125;</span>&gt;</span>Show modal<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;modal&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, appRoot);</span><br></pre></td></tr></table></figure>

<p>然而，如果這樣的設計場合發生在 Modal 視窗廣告社記，可能這樣般的操作其開啟的元素是相鄰元素而不是上下元素。因此我們可以透過 Portal 將 props.children 傳送到其他指定的非直系關係之 DOM 元素上。也就是 off 按鈕可以放在其他位置而不是只能在自己下層的組件裡面。</p>
<p>使用 Portal 需要透過<code>ReactDOM.createPortal(child, container)</code>來宣告，child 可以是任何要渲染的 React 之 child，實質內容可以 element、string 或 fragment。container 則是你想要放置目標的 DOM 元素。</p>
<p>調整上面範例如下，規劃出現 off 按鈕在<code>&lt;div id=&quot;modal-root&quot;&gt;&lt;/div&gt;</code>位置內，而不是本身<code>&lt;div id=&quot;app-root&quot;&gt;&lt;/div&gt;</code>內：</p>
<ul>
<li>為了動態生成 DOM，透過 useEffect 來操作生命週期產生 el(div 元素）放置卸除在<code>&lt;div id=&quot;app-root&quot;&gt;&lt;/div&gt;</code>內</li>
<li>在 Modal 組件的渲染動作下，要求獲得的 props.children 內容放到目標 el 內。</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPortal, render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> appRoot = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app-root&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> modalRoot = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;modal-root&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Modal</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 規劃掛載時，將 div 放置於 div#modal-root 內，並於卸載時移除</span></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    modalRoot.appendChild(el);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> modalRoot.removeChild(el);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// children 等價 &lt;button onClick=&#123;doHide&#125;&gt;Hide modal&lt;/button&gt;</span></span><br><span class="line">  <span class="keyword">return</span> createPortal(props.children, el);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [showModal, setShowModal] = useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> doShow = <span class="function">() =&gt;</span> setShowModal(<span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">const</span> doHide = <span class="function">() =&gt;</span> setShowModal(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> modal = showModal ? (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;doHide&#125;</span>&gt;</span>Hide modal<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line">  ) : <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;doShow&#125;</span>&gt;</span>Show modal<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;modal&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, appRoot);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>視覺化實例可從 <a target="_blank" rel="noopener" href="https://codepen.io/summer10920/pen/abLZPGe">CodePen 參考</a>。本篇參考來源為官方 <a target="_blank" rel="noopener" href="https://codepen.io/gaearon/pen/yzMaBd">CodePen 範例</a> 改編，差別於使用 function hook 完成。</p>
</blockquote>
<h4 id="傳送包含-Event-Bubbling"><a href="#傳送包含-Event-Bubbling" class="headerlink" title="傳送包含 Event Bubbling"></a>傳送包含 Event Bubbling</h4><p>Portal 特性為根據 React 內部存在 tree 來運作，因此本身不套用原 JavaScript 觀念上 DOM 的位置邏輯。這包含了 context 操作以及 Event Bubbling 事件傳遞冒泡 都能正常傳遞。</p>
<p>舉例 Event Bubbling 的基本觀念，若上層 div 有一個點擊事件，因 DOM 機制而將事件傳遞到其所有下層，因此按鈕 button 也是能觸發事件。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-root&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">&quot;doClick()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;backgroundColor: pink, padding: 10px&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>count:0<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>假若下層部分透過 protal 將傳送渲染至另一個 div 內，雖然 JavaScript 的 DOM 邏輯不該發生 button 可觸發事件，事實上因為由 React Tree 來規劃的，傳遞效果仍存在。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app-root&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">onclick</span>=<span class="string">&quot;doClick()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;backgroundColor: pink, padding: 10px&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>count:0<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;modal-root&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>整體 React 範例如下，視覺化實例可從 <a target="_blank" rel="noopener" href="https://codepen.io/summer10920/pen/abLmLKm">CodePen 參考</a>。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPortal, render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> appRoot = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app-root&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> modalRoot = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;modal-root&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Modal</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> el = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 規劃掛載時，將div放置於div#modal-root內，並於卸載時移除</span></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    modalRoot.appendChild(el);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> modalRoot.removeChild(el);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// children 等價 BubbleClick組件</span></span><br><span class="line">  <span class="keyword">return</span> createPortal(props.children, el);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> doClick = <span class="function">() =&gt;</span> setCount(count + <span class="number">1</span>); <span class="comment">//如果事件觸發，更改state做為測試是否成功</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// event規劃在上層，原本的子組件BubbleClick也會受傳遞到event，但Modal組件將這個children(BubbleClick組件) 進行 portal到別處DOM上</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;doClick&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor:</span> &#x27;<span class="attr">pink</span>&#x27;, <span class="attr">padding:</span> &#x27;<span class="attr">10px</span>&#x27; &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>count:&#123;count&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">BubbleClick</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BubbleClick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, appRoot);</span><br></pre></td></tr></table></figure>


<h1 id="代碼分割"><a href="#代碼分割" class="headerlink" title="代碼分割"></a>代碼分割</h1><p>React 本身透過 import 來載入必要的模組，而自己設計的組件也能學樣的規劃成外部組件庫透過 import 載入。export 可以將函式、物件甚至是純值匯出。而 import 與 export 本身來自 JavaScript 的模組管理方法。</p>
<p><strong>named export</strong><br>指定具名方式可以多個同時 export，而 import 時需要相同名稱才能使用。</p>
<figure class="highlight js"><figcaption><span>src/App.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WelcomeF</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WelcomeC</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123; <span class="comment">//表達此 class 組件要呈現的內容</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; WelcomeF, WelcomeC &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>src/index.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; WelcomeC, WelcomeF &#125; <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">WelcomeF</span> /&gt;</span></span>, <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#demo1&#x27;</span>));</span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">WelcomeC</span> /&gt;</span></span>, <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#demo2&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p><strong>default export</strong><br>預設輸出就只能輸出一組，視為這個檔案內的唯一輸出。但輸入時可以用任何其他名稱來承接。</p>
<figure class="highlight js"><figcaption><span>src/App.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WelcomeF</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> WelcomeF;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>src/index.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Demo <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">Demo</span> /&gt;</span></span>, <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#demo1&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>或者包裝成物件方式來使用。</p>
<figure class="highlight js"><figcaption><span>src/App.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WelcomeF</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WelcomeC</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123; <span class="comment">//表達此 class 組件要呈現的內容</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; WelcomeF, WelcomeC &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>src/index.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Demo <span class="keyword">from</span> <span class="string">&quot;./App&quot;</span>;</span><br><span class="line"></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">Demo.WelcomeC</span> /&gt;</span></span>, <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#demo1&#x27;</span>));</span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">Demo.WelcomeF</span> /&gt;</span></span>, <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#demo2&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="動態-import"><a href="#動態-import" class="headerlink" title="動態 import()"></a>動態 import()</h2><p>隨代碼的開發量變大，載入等待時間會影響網頁執行效能。可以考慮使用動態載入（非同步作業）透過 import() 函式，使程式碼讀取到此部分會自動額外進行載入。此功能為 Webpack(Create React App) 或其他 Next.js 框架提供之功能函式。</p>
<figure class="highlight js"><figcaption><span>src/App.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WelcomeF</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WelcomeC</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123; <span class="comment">//表達此 class 組件要呈現的內容</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello!!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123; WelcomeF, WelcomeC &#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>src/index.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//這段代碼可以在任何地方使用，不用一開始做 import。</span></span><br><span class="line"><span class="keyword">import</span>(<span class="string">&quot;./App&quot;</span>).then(<span class="function"><span class="params">obj</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(obj); <span class="comment">//因為非同步，時間上此晚出現</span></span><br><span class="line">  render(<span class="xml"><span class="tag">&lt;<span class="name">obj.WelcomeC</span> /&gt;</span></span>, <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#demo1&#x27;</span>));</span><br><span class="line">  render(<span class="xml"><span class="tag">&lt;<span class="name">obj.WelcomeF</span> /&gt;</span></span>, <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#demo2&#x27;</span>));</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Handle failure</span></span><br><span class="line">  <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;first command&#x27;</span>); <span class="comment">//會先出現</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果使用 default export 方式，獲得多一層為 default 的 object，使用上就變成為<code>obj.default.WelcomeC</code>。</p>
</blockquote>
<h2 id="優化載入-React-Suspense-amp-React-Lazy"><a href="#優化載入-React-Suspense-amp-React-Lazy" class="headerlink" title="優化載入 React Suspense &amp; React Lazy"></a>優化載入 React Suspense &amp; React Lazy</h2><p>在開發專案的時候透過 webpack 將不同模組的 component 打包成同一支 js，但規模越大載入時間也會拉長影響使用者體驗，而且並非所有的程式碼的功能會在一開始就使用。透過 React lazy 可以將程式碼拆分成不同的區塊延遲進行動態 import ，優先載入比較重要的 js。並搭配 suspense 包覆 component 讓 React 知道這部分內容需要等 Lazy 載入回來才能顯示，suspense 能使用多個 Lazy 組件。</p>
<blockquote>
<p>此來自 16.6 才開始有的功能，但無法在 SSR(server-side) 使用 (React 承諾將在未來版本上解決）。如果有 SSR 開發上使用需求則需要透過別人的 <a target="_blank" rel="noopener" href="https://github.com/gregberge/loadable-components">Loadable Components</a> 來解決。</p>
</blockquote>
<h3 id="React-lazy"><a href="#React-lazy" class="headerlink" title="React.lazy()"></a>React.lazy()</h3><p>此函式能協助我們從外部組件進行動態匯入，由於只能獲得一個組件結果因此只能對 default export 組件檔案存取。而參數必須是一個非同步連結（具備 Promise 回應）的 import() 函式結果。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> SomeComponent = React.lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./SomeComponent&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>接著就是搭配 Suspense 提供做為渲染使用。</p>
<h3 id="React-Suspense"><a href="#React-Suspense" class="headerlink" title="React.Suspense"></a>React.Suspense</h3><p>本身是一個預留用的組件標籤，提供屬性 fallback 能在未動態取回時呈現預設等待之內容。而下層內容為可指定 JSX 與 lazy。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./OtherComponent&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">OtherComponent</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>lazy 可以多個於同一個 Suspense 內。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./OtherComponent&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> AnotherComponent = React.lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./AnotherComponent&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">OtherComponent</span> /&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">AnotherComponent</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="抽取來自-named-export"><a href="#抽取來自-named-export" class="headerlink" title="抽取來自 named export"></a>抽取來自 named export</h3><p>由於 lazy() 只能對應一個組件，如果你的組件來自於 named export 其中一項將無法取得。只能透過一個中繼方式從中獲取指定一項輸出成 default export，再由 lazy 取回。</p>
<figure class="highlight js"><figcaption><span>ManyComponents.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ComponentA = <span class="comment">/* ... */</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ComponentB = <span class="comment">/* ... */</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><figcaption><span>MyComponentB.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; ComponentB <span class="keyword">as</span> <span class="keyword">default</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./ManyComponents.js&quot;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>MyApp.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; lazy &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> MyComponentB = lazy(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;./MyComponentB.js&quot;</span>));</span><br></pre></td></tr></table></figure>

<h1 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h1><p>用於解決多層組件由上至下傳遞 props 的繁瑣問題。而 Context 可在不使用 props 情況下完成，先創建 Context 全域組件變數後，能在起始點組件上塞入值，並在目的端取出值。適合用在一些下層多數組件都需要的變數。</p>
<p>舉例來說，下列組合組件的結構為 APP（提供參數）&gt;Toolbar&gt;ThemeButton&gt;Button（使用參數），勢必需要透過 prop 來一個個傳遞下去。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;render&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Toolbar</span> <span class="attr">theme</span>=<span class="string">&quot;yellow&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Toolbar</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">ThemedButton</span> <span class="attr">theme</span>=<span class="string">&#123;props.theme&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ThemedButton</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">theme</span>=<span class="string">&#123;props.theme&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Button</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor:</span> <span class="attr">props.theme</span> &#125;&#125;&gt;</span>DEMO<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;demo&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="class-的-Context"><a href="#class-的-Context" class="headerlink" title="class 的 Context"></a>class 的 Context</h2><p>Context 不支援 function 來使用（但可使用 Hook)，使用方式如下：</p>
<ol>
<li>在全域上利用<code>React.createContext()</code>建立 Context 組件變數，參數可提供一開始之初始值。</li>
<li>在需要使用此 Context 變數改寫值的地方，使用 Context.Provider 並指定屬性 value 進行內容值改變。React 自從被 createContext 時會去尋找最近的 Provider 讀取值。</li>
<li>接著在想要傳遞的組件放置在該 Context 標籤內，React 會幫你把此值往指定組件傳送過去。</li>
<li>中途組件不需特別設定。</li>
<li>目標 class 組件要取此 Context 時，需要特別指定此 context 給該組件的 contextType。<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, createContext &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyContext = createContext(<span class="string">&#x27;red&#x27;</span>); <span class="comment">//規劃 context 變數，初始賦予 red</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#x27;yellow&#x27;</span>&gt;</span>  //要將新值提供給 context 時，需要用標籤包覆起來。</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Toolbar</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">MyContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Toolbar</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">ThemedButton</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThemedButton</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">theme</span>=<span class="string">&#123;this.context&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 因為不知道要使用的 context 為何，因此需要綁定 class 的 contextType 為哪個 Context 變數</span></span><br><span class="line">ThemedButton.contextType = MyContext; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Button</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">backgroundColor:</span> <span class="attr">props.theme</span> &#125;&#125;&gt;</span>DEMO<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;demo&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li>或者專案環境支援 public class fields syntax 語法，與前步驟效果相同，可以改用 class 的 static 方式來設定 contextType。<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThemedButton</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> contextType = MyContext;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.context); <span class="comment">// yellow</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">theme</span>=<span class="string">&#123;this.context&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ThemedButton.contextType = MyContext;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="API-相關說明"><a href="#API-相關說明" class="headerlink" title="API 相關說明"></a>API 相關說明</h3><h4 id="React-createContext"><a href="#React-createContext" class="headerlink" title="React.createContext"></a>React.createContext</h4><p>建立一個 Context 物件，當 React 進行渲染到此指令，會從這個組件關聯樹狀尋找與他對應的 Provider 之內容值。如果找不到 Provider 則會以原本的初始參數來生效。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MyContext = React.createContext(defaultValue);</span><br></pre></td></tr></table></figure>

<h4 id="Context-Provider"><a href="#Context-Provider" class="headerlink" title="Context.Provider"></a>Context.Provider</h4><p>Context 物件會有一個 Provider 用的组件形式。Context 能被其他組件連接並修改 Context 的值，透過 Provider 組件屬性 value 來修改，並根據包覆的組件進行關聯樹狀傳遞此 Context。Provider 可以在不同的其他組件建立關聯樹狀。而一旦 value 產生變化 React 會去對關聯樹狀上的目標組件上重新渲染翻新此值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;MyContext.Provider value=&#123;<span class="comment">/* 某个值 */</span>&#125;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Class-contextType"><a href="#Class-contextType" class="headerlink" title="Class.contextType"></a>Class.contextType</h4><p>目標 Class 組件想從 Context 上獲得值，則必須要指定 Class 的 contextType 指定為哪個 Context 物件。接著能在任何生命週期或 render 上使用 this.context 取得內容值。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="built_in">this</span>.context;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">MyClass.contextType = MyContext;  <span class="comment">//method 1</span></span><br></pre></td></tr></table></figure>

<p>或者在支援 <a target="_blank" rel="noopener" href="https://babeljs.io/docs/en/babel-plugin-proposal-class-properties">public class fields</a> 環境，使用 static 類屬性來初始化這個 class 的 contextType。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> contextType = MyContext;  <span class="comment">//method 2</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="built_in">this</span>.context;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Context-Consumer"><a href="#Context-Consumer" class="headerlink" title="Context.Consumer"></a>Context.Consumer</h4><p>與 Context.Provider 雷同都是修改 context 值，但屬於適用在 render props 的方式下（之後介紹），依賴。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;MyContext.Consumer&gt;</span><br><span class="line">  &#123;<span class="function"><span class="params">value</span> =&gt;</span> <span class="comment">/* 基于 context 值进行渲染*/</span>&#125;</span><br><span class="line">&lt;/MyContext.Consumer&gt;</span><br></pre></td></tr></table></figure>

<h4 id="Context-displayName"><a href="#Context-displayName" class="headerlink" title="Context.displayName"></a>Context.displayName</h4><p>對 Context 提供一個名稱使用文字串，在開發工具上可以看見此 Context 名字。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MyContext = React.createContext(<span class="comment">/* some value */</span>);</span><br><span class="line">MyContext.displayName = <span class="string">&#x27;LokiName&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&lt;MyContext.Provider&gt; <span class="comment">// &quot;LokiName.Provider&quot; by DevTools</span></span><br><span class="line">&lt;MyContext.Consumer&gt; <span class="comment">// &quot;LokiName.Consumer&quot; by DevTools</span></span><br></pre></td></tr></table></figure>

<h3 id="範例：可變的-Context"><a href="#範例：可變的-Context" class="headerlink" title="範例：可變的 Context"></a>範例：可變的 Context</h3><p>首先我們產生一個靜態且尋源頭失敗的 Context 值。</p>
<ul>
<li>規劃 App 為主要組件，引用 ThemedButton 組件，ThemedButton 組件位於外部檔案 themed-button.js</li>
<li>ThemedButton 使用<code>ThemedButton.contextType = ThemeContext;</code>來獲得 theme 值。而 ThemeContext 組件位於外部檔案 theme-context.js</li>
<li>React 會去尋找上源的 Provider，因為找不到而使得 Context 的值為預設 theme.dark（資料來自同檔案）。</li>
<li>ThemedButton 組件因為會用到 props.children 來提供內容，渲染的 button 可透過{…props}當作屬性，一次灌入來自 ThemedButton 的 props 獲得內容。</li>
</ul>
<figure class="highlight js"><figcaption><span>index.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ThemedButton <span class="keyword">from</span> <span class="string">&#x27;./themed-button&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">ThemedButton</span>&gt;</span>Normal Button<span class="tag">&lt;/<span class="name">ThemedButton</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>themed-button.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ThemeContext &#125; <span class="keyword">from</span> <span class="string">&#x27;./theme-context&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThemedButton</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> props = <span class="built_in">this</span>.props;</span><br><span class="line">    <span class="keyword">let</span> theme = <span class="built_in">this</span>.context;</span><br><span class="line">    <span class="built_in">console</span>.log(&#123;...props&#125;);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ↓↓↓</span></span><br><span class="line"><span class="comment">    因為 ThemedButton 組件有內容，指定 button 元素持有&#123;...props&#125;屬性</span></span><br><span class="line"><span class="comment">    使得 button 來繼承 ThemeButton 的所有 props，包含了 props.children</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        &#123;<span class="attr">...props</span>&#125;  </span></span></span><br><span class="line"><span class="tag"><span class="xml">        <span class="attr">style</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">backgroundColor:</span> <span class="attr">theme.background</span>,</span></span></span><br><span class="line"><span class="tag"><span class="xml">          <span class="attr">color:</span> <span class="attr">theme.color</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">      /&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">ThemedButton.contextType = ThemeContext;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">來自 ThemedButton 因為找不到 Provider</span></span><br><span class="line"><span class="comment">因此默認值為 dark 而獲得 this.context=&#123;color: &#x27;#ffffff&#x27;, background: &#x27;#222222&#x27;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ThemedButton;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>theme-context.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> themes = &#123;</span><br><span class="line">  <span class="attr">light</span>: &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;#000000&#x27;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&#x27;#eeeeee&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">dark</span>: &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&#x27;#222222&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeContext = React.createContext(</span><br><span class="line">  themes.dark <span class="comment">//默認值</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>接著當作對造組，我們產生另一個透過 state 對應使得產生可變的 Context。</p>
<ul>
<li>App 建立 state 為 light 並規劃 event 事件來切換 dark，state 從 theme-context.js 的 theme 取得。</li>
<li>因此 theme-context.js 內的 theme 變數要 export 出來，提供 index.js 做 import。</li>
<li>APP 會引用 ThemeContext.Provider 這個 Context 並賦予他初始值，初始值來自 state 值。</li>
<li>ThemeContext 組件位於外部檔案 themed-context.js 記得 import</li>
<li>為了區別出不同 ThemedButton 組件，多一個仲介 Toolbar 組件，提供 onclick 給 ThemedButton<figure class="highlight js"><figcaption><span>index.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> ThemedButton <span class="keyword">from</span> <span class="string">&#x27;./themed-button&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ThemeContext, themes &#125; <span class="keyword">from</span> <span class="string">&#x27;./theme-context&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多一個仲介組件來賦予 props 值，Toolbar 的 themeButton 額外持有 App 的 state</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Toolbar</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ThemedButton</span> <span class="attr">onClick</span>=<span class="string">&#123;props.changeTheme&#125;</span>&gt;</span>Change Theme<span class="tag">&lt;/<span class="name">ThemedButton</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">theme</span>: themes.light,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  toggleTheme = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(<span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">theme</span>:</span><br><span class="line">        state.theme === themes.dark</span><br><span class="line">          ? themes.light</span><br><span class="line">          : themes.dark,</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//在 ThemeContext 內的 ThemedButton 能獲得 state 值</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ThemedButton</span>&gt;</span>Normal Button<span class="tag">&lt;/<span class="name">ThemedButton</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;this.state.theme&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Toolbar</span> <span class="attr">changeTheme</span>=<span class="string">&#123;this.toggleTheme&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><figcaption><span>theme-context.js</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> themes = &#123;</span><br><span class="line">  <span class="attr">light</span>: &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;#000000&#x27;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&#x27;#eeeeee&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">dark</span>: &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&#x27;#222222&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ThemeContext = React.createContext(</span><br><span class="line">  themes.dark <span class="comment">//默認值</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
現在檢查畫面 (<a target="_blank" rel="noopener" href="https://codepen.io/summer10920/pen/xxXxZaQ?editors=1010">CodePen 預覽</a>)，能發現已產生可變化的 context，原因在於 Context 幫助我們把 App 的 state 值與修改權限透過 Context 傳遞給 Button 當參數使用。而 Context 也能反向找到上源頭的 Provider 獲得初始值 light。</li>
</ul>
<h2 id="不使用-Context-的替代方案"><a href="#不使用-Context-的替代方案" class="headerlink" title="不使用 Context 的替代方案"></a>不使用 Context 的替代方案</h2><p>Context 主要是讓在不同層級下的多數組件能訪問相同的數據使用。但如果只是只針對一組使用來說整體的規畫準備就不太適合。假設與前面例子類似有以下組件需要傳遞。如果都使用 props 來接力傳遞就太笨拙，下例當中 Context 只有 Link 這個組件標籤使用存取，整體來說就不划算。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;Page user=&#123;user&#125; avatarSize=&#123;avatarSize&#125; /&gt;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">PageLayout</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> <span class="attr">avatarSize</span>=<span class="string">&#123;avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">NavigationBar</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> <span class="attr">avatarSize</span>=<span class="string">&#123;avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&#123;user.permalink&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Avatar</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> <span class="attr">size</span>=<span class="string">&#123;avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>我們可改用 Component 組合模型來規畫此功能。先將範例設計出來逐步修改，首先用到 props.childen 來解決 Link&gt;Avatar 的組合模型。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">permalink</span>: <span class="string">&quot;http://www.loki.com&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;./loki.jpg&quot;</span></span><br><span class="line">  &#125;, avatarSize = <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Page</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> <span class="attr">avatarSize</span>=<span class="string">&#123;avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Page</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">PageLayout</span> <span class="attr">user</span>=<span class="string">&#123;props.user&#125;</span> <span class="attr">avatarSize</span>=<span class="string">&#123;props.avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PageLayout</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">NavigationBar</span> <span class="attr">user</span>=<span class="string">&#123;props.user&#125;</span> <span class="attr">avatarSize</span>=<span class="string">&#123;props.avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NavigationBar</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&#123;props.user.permalink&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Avatar</span> <span class="attr">user</span>=<span class="string">&#123;props.user&#125;</span> <span class="attr">size</span>=<span class="string">&#123;props.avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Link</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;props.href&#125;</span>&gt;</span>&#123;props.children&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avatar</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;props.user.img&#125;</span> <span class="attr">width</span>=<span class="string">&#123;props.size&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;demo&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>接著將會用到這些資料的組件標籤提升到與資料來源相同的同層組件，將直接獲得這些數據的組件標籤當作內容傳遞下去。這樣的設計只有 App 組件是知道 Link 與 Avatar 是如何去使用 user 與 size 資料的，其他下層組件不用去幫忙傳遞這兩筆，但會幫忙傳遞整個組件下去。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> user = &#123;</span><br><span class="line">    <span class="attr">permalink</span>: <span class="string">&quot;http://www.loki.com&quot;</span>,</span><br><span class="line">    <span class="attr">img</span>: <span class="string">&quot;./loki.jpg&quot;</span></span><br><span class="line">  &#125;, avatarSize = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userLink = (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&#123;user.permalink&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Avatar</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> <span class="attr">size</span>=<span class="string">&#123;avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Page</span> <span class="attr">userLink</span>=<span class="string">&#123;userLink&#125;</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Page</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">PageLayout</span> <span class="attr">userLink</span>=<span class="string">&#123;props.userLink&#125;</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">PageLayout</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">NavigationBar</span> <span class="attr">userLink</span>=<span class="string">&#123;props.userLink&#125;</span> /&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NavigationBar</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> props.userLink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Link</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;props.href&#125;</span>&gt;</span>&#123;props.children&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avatar</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;props.user.img&#125;</span> <span class="attr">width</span>=<span class="string">&#123;props.size&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;description&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;demo&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>這樣的反轉寫法雖然還是 props 大隊接力，但能減少 props 的使用量並減少代碼。如果你想傳遞的不只一個組件，可以再多一組件變數做兩筆大隊接力傳遞。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Page</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> user = props.user;</span><br><span class="line">  <span class="keyword">const</span> content = <span class="xml"><span class="tag">&lt;<span class="name">Feed</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> /&gt;</span></span>; <span class="comment">//組件模型</span></span><br><span class="line">  <span class="keyword">const</span> topBar = (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">NavigationBar</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Link</span> <span class="attr">href</span>=<span class="string">&#123;user.permalink&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Avatar</span> <span class="attr">user</span>=<span class="string">&#123;user&#125;</span> <span class="attr">size</span>=<span class="string">&#123;props.avatarSize&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">NavigationBar</span>&gt;</span></span></span><br><span class="line">  ); <span class="comment">//組件模型</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">PageLayout</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">topBar</span>=<span class="string">&#123;topBar&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">content</span>=<span class="string">&#123;content&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">    /&gt;</span></span></span><br><span class="line">  );<span class="comment">//傳遞 2 個組件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="hook-的-Context"><a href="#hook-的-Context" class="headerlink" title="hook 的 Context"></a>hook 的 Context</h2><p>如果是採用 function 組件並搭配 hook 方式設計，hook 提供 context 函式供給使用。整題流程大同小異</p>
<ol>
<li>透過 React.createContext(default value) 取得 Context 變數並賦予預設值。</li>
<li>透過 Context 組件的 Provider 來設定源頭包覆位置，並可透過 value 提供初始值。</li>
<li>終端組件透過 useContext(Context 名稱）來指定該組件接收來自哪個 Context。</li>
<li>最後，該終端組件可獲取來自 Context 值與變化。</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> themes = &#123;</span><br><span class="line">  <span class="attr">light</span>: &#123;</span><br><span class="line">    <span class="attr">foreground</span>: <span class="string">&quot;#000000&quot;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&quot;#eeeeee&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">dark</span>: &#123;</span><br><span class="line">    <span class="attr">foreground</span>: <span class="string">&quot;#ffffff&quot;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&quot;#222222&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ThemeContext = React.createContext(themes.light);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;themes.dark&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Toolbar</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Toolbar</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">ThemedButton</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ThemedButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> theme = useContext(ThemeContext);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">background:</span> <span class="attr">theme.background</span>, <span class="attr">color:</span> <span class="attr">theme.foreground</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">      I am styled by theme context!</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h1><p>典型的 React 操作設計，會利用 props 與 state 來規劃上下層級組件，並透過更改 props 值存取調整影響渲染 render 畫面更新。這裡介紹的 ref 則是不同的資料觀念。ref 可以是一個 JSX 元素或是一個下層組件代表。透過 ref 標記，就能以 current 方式找到這個對象做影響操作，而不是透過 props 完成資料操作。</p>
<p>ref 的生命週期有以下特性：</p>
<ul>
<li>ref 在生命週期的 mount 當下產生 current 結果，而 unmount 時則清空 current 為 null。</li>
<li>ref 的更新時機在生命週期的 componentDidMount 或 componentDidUpdate 之前。</li>
</ul>
<p>ref 可以有兩種用途，一種是讀取 JSX 元素做事件反應，另一種是讀取 Class 組件的物件實例 instance 進行操作。</p>
<h2 id="向-DOM-元素添加-Ref"><a href="#向-DOM-元素添加-Ref" class="headerlink" title="向 DOM 元素添加 Ref"></a>向 DOM 元素添加 Ref</h2><p>ref 可對本體組件內的 render 內的 JSX 元素打上 ref 屬性標記，透過 current 來採用 JavaScript 原生 DOM 節點進行改變操作。React 會自動偵測該 DOM 節點的變化產生渲染而不是透過 props 來偵測。以下為步驟操作：</p>
<ol>
<li>建立一個 ref 物件。class 組件與 function 組件（使用 Hook) 寫法有所差異。</li>
<li>在 render() 內的 JSX 語法上，對指定的元素設定屬性<code>ref=&#123;REF_NAME&#125;</code>。</li>
<li>可在其他地方透過<code>this.REF_NAME.current</code>來獲得該 DOM 節點，例如可規劃一個 event 事件去做一些反應或操作此 Node。</li>
</ol>
<h3 id="Class-組件-的-ref"><a href="#Class-組件-的-ref" class="headerlink" title="Class 組件 的 ref"></a>Class 組件 的 ref</h3><p>建立 ref 方式為透過<code>React.createRef()</code>並另名：以下範例為一個 input:text 為我們的 ref 元素，另外兩個按鈕透過 event 事件來對 current（等價該 DOM 節點）操作 DOM。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  textInput = React.createRef();</span><br><span class="line"></span><br><span class="line">onFocus = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.textInput.current); <span class="comment">// 等價 &lt;input type=&quot;text&quot;&gt; 這個 DOM 元素</span></span><br><span class="line">    <span class="built_in">this</span>.textInput.current.focus(); <span class="comment">//操作 DOM 做 focus</span></span><br><span class="line">  &#125;</span><br><span class="line">  onVal = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.textInput.current.value = <span class="built_in">this</span>.textInput.current.value.concat(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;this.textInput&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onFocus&#125;</span>&gt;</span>focus input<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onVal&#125;</span>&gt;</span>push value A<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">CustomTextInput</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="function-組件-的-ref"><a href="#function-組件-的-ref" class="headerlink" title="function 組件 的 ref"></a>function 組件 的 ref</h3><p>建立 ref 物件會透過 useRef() 來達到，同上範例改成 function 組件之寫法。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CustomTextInput</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> textInput = useRef();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> onFocus = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    textInput.current.focus();</span><br><span class="line">    <span class="built_in">console</span>.log(textInput.current);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> onVal = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    textInput.current.value = textInput.current.value.concat(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;textInput&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;onFocus&#125;</span>&gt;</span>focus input<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;onVal&#125;</span>&gt;</span>push value A<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">CustomTextInput</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="向下層-Class-Component-添加-Ref"><a href="#向下層-Class-Component-添加-Ref" class="headerlink" title="向下層 Class Component 添加 Ref"></a>向下層 Class Component 添加 Ref</h2><p>與前者步驟相同但差別用途於在 class component 上時，則是獲得這個下層 class 組件的物件實例 instance。</p>
<blockquote>
<p>注意你只能對下層為 Class 之類型組件使用標記 ref，無法對 function 組件做標 ref 記（因為沒有 instance 可做為 current 目標）。</p>
</blockquote>
<p>舉例，規劃一個 class 上層組件，在 render 時對下層 class 組件註記 ref。我們就能對該 class 的 instance 進行動作，例如透過上層的生命週期來執行下層組件的函式方法觸發。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  textInput = React.createRef();</span><br><span class="line"></span><br><span class="line">  onFocus = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.textInput.current.focus();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.textInput.current);</span><br><span class="line">  &#125;</span><br><span class="line">  onVal = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.textInput.current.value = <span class="built_in">this</span>.textInput.current.value.concat(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;this.textInput&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onFocus&#125;</span>&gt;</span>focus input<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onVal&#125;</span>&gt;</span>push value A<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoFocus</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  childClass = React.createRef();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.childClass.current); <span class="comment">//獲得這個組件的物件實例 instance，也就是能直接執行該 class 內的函式方法</span></span><br><span class="line">    <span class="built_in">this</span>.childClass.current.onFocus(); <span class="comment">//觸發 CustomTextInput 組件內的 onFocus()</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">CustomTextInput</span> <span class="attr">ref</span>=<span class="string">&#123;this.childClass&#125;</span> /&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">AutoFocus</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="Callback-Refs"><a href="#Callback-Refs" class="headerlink" title="Callback Refs"></a>Callback Refs</h2><p>整體應用方式與前面一樣，唯獨設定 Ref 的方式上有所不同。不是產生 React.createRef() 的 ref 物件而是透過自訂 function 來獲得 instance 內的變數並 callback 給目標 ref 屬性。且不用 current 來找到該資料直接就能使用。</p>
<ol>
<li>建立一個 instance 變數作為 Ref，初始為 null</li>
<li>自訂一個箭頭 function，透過獲得來源的參數來複寫該變數</li>
<li>在目標 JSX 元素或下層組件，屬性 ref 則對應該自訂 function，React 會將此對象當作參數引入該 function，使得完成 callback ref 動作</li>
<li>讀取該目標方式不再需要使用 current，整體動作與 React.createRef() 作法一致</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomTextInput</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// textInput = React.createRef();</span></span><br><span class="line">  textInput = <span class="literal">null</span>;</span><br><span class="line">  settextInputRef = <span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.textInput = val;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onFocus = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// this.textInput.current.focus();</span></span><br><span class="line">    <span class="built_in">this</span>.textInput.focus();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.textInput);</span><br><span class="line">  &#125;</span><br><span class="line">  onVal = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// this.textInput.current.value = this.textInput.current.value.concat(&quot;A&quot;);</span></span><br><span class="line">    <span class="built_in">this</span>.textInput.value = <span class="built_in">this</span>.textInput.value.concat(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;this.settextInputRef&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onFocus&#125;</span>&gt;</span>focus input<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onClick</span>=<span class="string">&#123;this.onVal&#125;</span>&gt;</span>push value A<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AutoFocus</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// childClass = React.createRef();</span></span><br><span class="line">  childClass = <span class="literal">null</span>;</span><br><span class="line">  setchildClassRef = <span class="function"><span class="params">cpm</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.childClass = cpm;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.childClass.onFocus();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">CustomTextInput</span> <span class="attr">ref</span>=<span class="string">&#123;this.setchildClassRef&#125;</span> /&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">AutoFocus</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>而這個方式就能適用在下層為 function 組件的環境上。</p>
<h2 id="傳送-Ref"><a href="#傳送-Ref" class="headerlink" title="傳送 Ref"></a>傳送 Ref</h2><p>目前學會的 ref 都是在同層組件內去取得 DOM，但在很少的情況下可能會想要從上層組件獲取下層組件的 DOM 節點。這就需要透過傳送 React.forwardRef() 來幫助我們將下層組件的 DOM 暴露出來提供上層組件獲取。傳送 ref 能把 ref 從上層組件傳遞到它下層組件的技巧。但一般情況不建議這麼做，因為這會破壞組件封裝，但有時候這麼做對於觸發 focus 或測量下層組件的 DOM 節點的大小、位置是很有用的。</p>
<p>一些情況下，有些最底層的組件只是普通的 DOM 像是按鈕或表單欄位被多個上層組件通用，此時這些上層組件就希望能去控制這些底層組件 DOM 進行像是 focus、click、甚至特效，上一層組件想獲取該底層組件的 DOM 是可能發生的。</p>
<p>舉例有一個底層組件被兩個上層組件所使用，如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyButton</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;FancyButton&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;props.children&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">FancyButton</span>&gt;</span>Click 1!<span class="tag">&lt;/<span class="name">FancyButton</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App2</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">FancyButton</span>&gt;</span>Click 2!<span class="tag">&lt;/<span class="name">FancyButton</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">App1</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">App2</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  , <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>為了讓兩個上層組件根據各自需求去獲得底層組件按鈕的 DOM，是必要透過傳送 ref 將原本只能控制自己 ref 跨到底層組件去。將底層組件進行改寫，使用 React.forwardRef() 函式讓這個底層組件除了 props 也可接受來自上層的 ref 物件，暴露自己的 DOM 給上層。該傳送 ref 函式需放入一匿名箭頭函式。</p>
<p>最後，是時尚這個底層組件已經不算是原本的組件設計，而是一個 forwardRef 提供給你的 JSX 元件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// function FancyButton(props) &#123;</span></span><br><span class="line"><span class="comment">//   return (</span></span><br><span class="line"><span class="comment">//     &lt;button className=&quot;FancyButton&quot;&gt;</span></span><br><span class="line"><span class="comment">//       &#123;props.children&#125;</span></span><br><span class="line"><span class="comment">//     &lt;/button&gt;</span></span><br><span class="line"><span class="comment">//   );</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FancyButton = React.forwardRef(</span><br><span class="line">  <span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;FancyButton&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;props.children&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> refApp1 = useRef();</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;refApp1&#x27;</span>, refApp1.current); <span class="comment">//&lt;button class=&quot;FancyButton&quot;&gt;Click 1!&lt;/button&gt;</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">FancyButton</span> <span class="attr">ref</span>=<span class="string">&#123;refApp1&#125;</span>&gt;</span>Click 1!<span class="tag">&lt;/<span class="name">FancyButton</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App2</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  refApp2 = React.createRef();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;refApp2&#x27;</span>, <span class="built_in">this</span>.refApp2.current); <span class="comment">//&lt;button class=&quot;FancyButton&quot;&gt;Click 2!&lt;/button&gt;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">FancyButton</span> <span class="attr">ref</span>=<span class="string">&#123;this.refApp2&#125;</span> &gt;</span> Click 2!<span class="tag">&lt;/<span class="name">FancyButton</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">App1</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">App2</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  , <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>傳送 ref 的用途除了對外部底層 DOM 操作，也能對外部組件操作獲得物件實例，此不再示範。</p>
<h3 id="開發工具上的客製化名稱"><a href="#開發工具上的客製化名稱" class="headerlink" title="開發工具上的客製化名稱"></a>開發工具上的客製化名稱</h3><p>如果使用開發工具觀察組件關係，可發現原本底層組件的名稱已變成 ForwardRef。這是因為已經不是原先一個組件按鈕結構而是由 ForwardRef 所提供的下層組件。如果有需要是可以修改此預設名稱。</p>
<p><img src="https://i.imgur.com/FRyCjho.png"></p>
<h4 id="方法-1：提供具名函式"><a href="#方法-1：提供具名函式" class="headerlink" title="方法 1：提供具名函式"></a>方法 1：提供具名函式</h4><p>原本是底層組件設計時提供匿名箭頭函式，改為具名的函式做為 ForwardRef 之參數。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FancyButton = React.forwardRef(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">hasName1</span>(<span class="params">props, ref</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;FancyButton&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;props.children&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> refApp1 = useRef();</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;refApp1&#x27;</span>, refApp1.current); <span class="comment">//&lt;button class=&quot;FancyButton&quot;&gt;Click 1!&lt;/button&gt;</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">FancyButton</span> <span class="attr">ref</span>=<span class="string">&#123;refApp1&#125;</span>&gt;</span>Click 1!<span class="tag">&lt;/<span class="name">FancyButton</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">App1</span> /&gt;</span></span></span><br><span class="line">  , <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/6PFkhRX.png"></p>
<h4 id="方法-2：透過具名函式增加-displayName-物件屬性"><a href="#方法-2：透過具名函式增加-displayName-物件屬性" class="headerlink" title="方法 2：透過具名函式增加 displayName 物件屬性"></a>方法 2：透過具名函式增加 displayName 物件屬性</h4><p>同樣是提供具名函式，React 會先判別這個函式物件屬性 displayName 作為名稱，找不到則以該函式名為稱呼。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hasName2</span>(<span class="params">props, ref</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&quot;FancyButton&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;props.children&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line">hasName2.displayName = <span class="string">&#x27;mdyName2&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FancyButton = React.forwardRef(hasName2);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App2</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  refApp2 = React.createRef();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;refApp2&#x27;</span>, <span class="built_in">this</span>.refApp2.current); <span class="comment">//&lt;button class=&quot;FancyButton&quot;&gt;Click 2!&lt;/button&gt;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">FancyButton</span> <span class="attr">ref</span>=<span class="string">&#123;this.refApp2&#125;</span> &gt;</span> Click 2!<span class="tag">&lt;/<span class="name">FancyButton</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">App2</span> /&gt;</span></span></span><br><span class="line">  , <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/hvPOp7M.png"></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
              <a href="/tags/ReactJS/" rel="tag"># ReactJS</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/11-16/js-react-hook/" rel="prev" title="[學習之路] JS 前端框架 React - Hook">
                  <i class="fa fa-chevron-left"></i> [學習之路] JS 前端框架 React - Hook
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/04-13/js-angular-1/" rel="next" title="[學習之路] JS 前端框架 Angular - 介紹與安裝">
                  [學習之路] JS 前端框架 Angular - 介紹與安裝 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  <span>
    <span class="with-love">
      <i class="fa fa-star"></i>
    </span>
    <span class="author" itemprop="copyrightHolder" title="找我？！側單左上連結">Loki Jiang</span>
  </span>

  <span>
    <span class="post-meta-item-icon with-love">
      <i class="fas fa-copyright"></i>
    </span>
    2020 – 
    <span itemprop="copyrightYear">2022</span> All rights reserved.
  </span>
</div>
<div class="wordcount busuanzi-count">
  <span class="post-meta-item">
    <span class="post-meta-item-icon with-love">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="全站總字數">1624848 <i>words</i></span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon with-love">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="全站總閱讀時間">2954 <i>mins</i></span>
  </span>
  <span class="post-meta-item" id="busuanzi_container_site_uv">
    <span class="post-meta-item-icon with-love">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="訪客總數">
      <span id="busuanzi_value_site_uv"></span><i> visitors</i>
    </span>
  </span>
  <span class="post-meta-item" id="busuanzi_container_site_pv">
    <span class="post-meta-item-icon with-love">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="總瀏覽次數">
      <span id="busuanzi_value_site_pv"></span><i> watched</i>
    </span>
  </span>
</div>
    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":"forest","js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.11.2/dist/mermaid.min.js","integrity":"sha256-lBK8/r0PCT3qtPtIvDcaT+20nHioFbzRGg36kOJ+wz4="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"
    integrity="sha512-lGnVsh3WK0YJ7NX7rQmUu6kqF7vqELuDrUTnxpI2iD86VwI+OlQhi3EAJJZbrBUOfDFOAYAkigxkApHGM2IZTg=="
    crossorigin="anonymous"></script>
<script src="/js/loki.js"></script>

</body>
</html>
