---
title: '[前端框架] Angular - 模組、'
categories:
  - Zero Road
  - Angular
tag:
  - Angular
  - JavaScript
date: 2023-03-14 11:02:45
---

![](https://i.imgur.com/WC5iApN.png)
待補充
<!-- 本篇介紹 Sass 這套預處理器，他能將大型專案上編寫 CSS 不易維護的問題進行改善。使用 Sass 的 Script 語言來進行 CSS 開發，再透過編譯 complier 後轉為瀏覽器可閱讀的 CSS。 -->

<!-- more -->

---

# Modules
模組（Modules）是 Angular 中的核心概念之一。它們是由 Angular 模組（Angular Module）負責定義、維護和載入。每個應用程序至少有一個模組，這個模組被稱為根模組（Root Module），其他模組可以被應用程序擴充和引用。

模組主要用於將應用程序拆分成可重用和可管理的部分，並定義應用程序的結構和功能。模組內可以包含元件 Components、服務 Services、指令 Directives、管道 custom Pipes 等等。通過將相關的元件和其他應用程序資源放在同一個模組中，可以更好地組織和管理代碼。

在 Angular 中，模組主要通過裝飾器來定義和配置。通過裝飾器，可以指定模組名稱、導入的模組、導出的元件和服務、提供的服務等等。一個簡單的模組定義如下：

```typescript app.module.ts
import { AuthInterceptorService } from './auth/auth-interceptor.service';
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { FormsModule, ReactiveFormsModule } from '@angular/forms';
import { HttpClientModule, HTTP_INTERCEPTORS } from '@angular/common/http';

import { AppComponent } from './app.component';
import { HeaderComponent } from './header/header.component';
import { RecipesComponent } from './recipes/recipes.component';
import { RecipeListComponent } from './recipes/recipe-list/recipe-list.component';
import { RecipeDetailComponent } from './recipes/recipe-detail/recipe-detail.component';
import { RecipeItemComponent } from './recipes/recipe-list/recipe-item/recipe-item.component';
import { ShoppingListComponent } from './shopping-list/shopping-list.component';
import { ShoppingEditComponent } from './shopping-list/shopping-edit/shopping-edit.component';
import { DropdownDirective } from './shared/dropdown.directive';
import { ShoppingListService } from './shopping-list/shopping-list.service';
import { AppRoutingModule } from './app-routing.module';
import { RecipeStartComponent } from './recipes/recipe-start/recipe-start.component';
import { RecipeEditComponent } from './recipes/recipe-edit/recipe-edit.component';
import { RecipeService } from './recipes/recipe.service';
import { AuthComponent } from './auth/auth.component';
import { LoadingSpinnerComponent } from './shared/loading-spinner/loading-spinner.component';
import { AlertComponent } from './shared/alert/alert/alert.component';

@NgModule({
  declarations: [ // 聲明所有 components, directives, custom pipes 於 array 內
    AppComponent,
    HeaderComponent,
    RecipesComponent,
    RecipeListComponent,
    RecipeDetailComponent,
    RecipeItemComponent,
    ShoppingListComponent,
    ShoppingEditComponent,
    DropdownDirective,
    RecipeStartComponent,
    RecipeEditComponent,
    AuthComponent,
    LoadingSpinnerComponent,
    AlertComponent,
  ],
  imports: [ //允許將其他的模組加入到此模組內，所以拆分 module 時很重要
    BrowserModule,
    FormsModule, // 舉例此內建的表單 module 能讓整個專案使用
    ReactiveFormsModule,
    HttpClientModule,
    AppRoutingModule // 路由用的模組，額外於下面代碼另解釋
  ],
  providers: [ // 定義所有的服務，若不想在此定義可以在該 service 內填寫`@Injectable({ providedIn: 'root' })`注入於整個專案 root
    ShoppingListService,
    RecipeService, {
      provide: HTTP_INTERCEPTORS,
      useClass: AuthInterceptorService,
      multi: true
    }
  ],
  bootstrap: [AppComponent], //引導哪個元件對應 index.html 的<app-root>
  entryComponents:[ //動態元件使用元件
    AlertComponent,
  ]
})

@NgModule({
  declarations: [ AppComponent ], 
  imports: [ BrowserModule ], 
  bootstrap: [ AppComponent ]
})
export class AppModule { }
```

在這個例子中，@NgModule 裝飾器被用來定義一個模組 AppModule，並通過 declarations 屬性聲明了該模組包含一個名為 AppComponent 的元件。imports 屬性用來導入該模組需要的其他模組，這裡導入了 BrowserModule。bootstrap 屬性指定了模組的根元件，這裡是 AppComponent。

此外你也可以從 app-routing.module.ts 可以看到 @NgModule 裝飾器的編寫。app-routing 模組用來保存所有路由配置。你可以把路由寫在 app.module.ts 內，但因為代碼量太大才透過拆分方式另寫成 app-routing.module.ts，使得 app.module.ts 更精簡與維護。

```typescript src\app\app-routing.module.ts
import { AuthGuard } from './auth/auth-guard.service';
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';

import { RecipesComponent } from './recipes/recipes.component';
import { ShoppingListComponent } from './shopping-list/shopping-list.component';
import { RecipeStartComponent } from './recipes/recipe-start/recipe-start.component';
import { RecipeDetailComponent } from './recipes/recipe-detail/recipe-detail.component';
import { RecipeEditComponent } from './recipes/recipe-edit/recipe-edit.component';
import { RecipesResolverService } from './recipes/recipes-resolver.service';
import { AuthComponent } from './auth/auth.component';

const appRoutes: Routes = [
  { path: '', redirectTo: '/recipes', pathMatch: 'full' },
  {
    path: 'recipes',
    component: RecipesComponent,
    canActivate: [AuthGuard],
    children: [
      { path: '', component: RecipeStartComponent },
      { path: 'new', component: RecipeEditComponent },
      {
        path: ':id',
        component: RecipeDetailComponent,
        resolve: [RecipesResolverService]
      },
      {
        path: ':id/edit',
        component: RecipeEditComponent,
        resolve: [RecipesResolverService]
      }
    ]
  },
  { path: 'shopping-list', component: ShoppingListComponent },
  { path: 'auth', component: AuthComponent }
];

@NgModule({
  imports: [RouterModule.forRoot(appRoutes)], 
  /**
    導入內建的 Router 模組，由 Angular 提供路由進行特殊方法，
    再將我們指定路由規則的 appRoutes 物件參數提供給路由模組成為新規則的 RouterModule
  **/
  exports: [RouterModule]
  /**
    最後需導出 Router 模組，才能在 App.module.ts 裡面導入使用
  **/
})
export class AppRoutingModule { }
```

## 環境建置準備
本篇的起始素材放置於 GitHub 底下提供使用，使用資料目錄 lokiModule 作為初始環境。下載請記得 npm install 初始化環境。

>[Github download](https://github.com/summer10920/angularTraining) at lokiModule-start Folder

這份素材跟隨上次素材作業 lokiHttp 為中繼存放點，若您已持有可繼續使用。

## appModule 拆分至 RecipesModule
本篇將示範將 app.module.tss 內的與 recipes 相關的作業獨立出一個 feature module，放置於 recipes 底下：

- 透過手動或 CLI 指令`ng g m recipes`建立於 src\app\recipes\recipes.module.ts
- 將 aap.module.ts 內 declarations 所指定的 Recipes 相關元件搬移至 recipes.module.ts（包含 import 聲明）
- 將 recipes.module.ts 宣告於 app.module.ts 內的 import 使得 app.module.ts 能載入此 feature module。
- 我們也可以將 Recipes 元件寫在 exports，使得整個其他模組能使用。（本素材上沒有此需求，可寫可不寫）

```typescript src\app\app.module.ts
// import { RecipesComponent } from './recipes/recipes.component';
// import { RecipeListComponent } from './recipes/recipe-list/recipe-list.component';
// import { RecipeDetailComponent } from './recipes/recipe-detail/recipe-detail.component';
// import { RecipeItemComponent } from './recipes/recipe-list/recipe-item/recipe-item.component';
// ...
// import { RecipeStartComponent } from './recipes/recipe-start/recipe-start.component';
// import { RecipeEditComponent } from './recipes/recipe-edit/recipe-edit.component';
import { RecipesModule } from './recipes/recipes.module'; // ※重點

@NgModule({
  declarations: [
    AppComponent,
    HeaderComponent,
    // RecipesComponent,
    // RecipeListComponent,
    // RecipeDetailComponent,
    // RecipeItemComponent,
    ShoppingListComponent,
    ShoppingEditComponent,
    DropdownDirective,
    // RecipeStartComponent,
    // RecipeEditComponent,
    AuthComponent,
    LoadingSpinnerComponent,
    AlertComponent,
  ],
  imports: [
    BrowserModule,
    FormsModule,
    ReactiveFormsModule,
    HttpClientModule,
    AppRoutingModule,
    RecipesModule // ※重點
  ],
  providers: [
    ShoppingListService,
    RecipeService, {
      provide: HTTP_INTERCEPTORS,
      useClass: AuthInterceptorService,
      multi: true
    }
  ],
  bootstrap: [AppComponent],
  entryComponents: [
    AlertComponent,
  ]
})
export class AppModule { }
```
```typescript src\app\recipes\recipes.module.ts
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';

import { RecipesComponent } from './recipes.component';
import { RecipeListComponent } from './recipe-list/recipe-list.component';
import { RecipeDetailComponent } from './recipe-detail/recipe-detail.component';
import { RecipeItemComponent } from './recipe-list/recipe-item/recipe-item.component';
import { RecipeStartComponent } from './recipe-start/recipe-start.component';
import { RecipeEditComponent } from './recipe-edit/recipe-edit.component';

@NgModule({
  declarations: [
    RecipesComponent,
    RecipeListComponent,
    RecipeDetailComponent,
    RecipeItemComponent,
    RecipeStartComponent,
    RecipeEditComponent,
  ],
  imports: [
    CommonModule,
  ],
  exports: [
    RecipesComponent,
    RecipeListComponent,
    RecipeDetailComponent,
    RecipeItemComponent,
    RecipeStartComponent,
    RecipeEditComponent,
  ],
})
export class RecipesModule { }
```

其中，exports 屬性是 NgModule 設置，用於將 NgModule 中的組件、指令等導出，從而讓其他模組可以使用它們。如果某個模組中的組件或指令未導出，其他模組就無法直接使用它們。

在使用 exports 屬性時，需要注意以下幾點：

- 可以將 exports 設置為一個組件類型，也可以設置為一個陣列，其中包含多個組件類型。
- 如果 NgModule 中的某個組件或指令被其他模組引用，但未導出，就會報錯。
- 如果要使用某個 NgModule 中導出的組件或指令，可以將該 NgModule 導入到需要使用它們的模組中，並將它們添加到 imports 屬性中。
總之，exports 屬性是一個非常重要的屬性，可以讓我們輕鬆地共用組件、指令等功能，提高代碼的重用性和可維護性。

此時，發現網頁執行可以獲得錯誤資訊`'router-outlet' is not a known element:`。這是由於彼此 module 所 import 的模組都是獨立不共享的，即使 app module 有 import 了 AppRoutingModule，但在 RecipesModule 內因獨立作業因此並沒有繼承路由模組。因此 RecipesModule 集合的這些 Recipe 元件若需要使用 router 就會看不懂（舉例 RecipesComponent.html)。這現象僅限於 Module，唯獨 Service 可以共享使用。

為了解決此事，你需要在指定模組下這些元件若有使用內建模組也需 import 使用。

```typescript src\app\recipes\recipes.module.ts
import { ReactiveFormsModule } from '@angular/forms';
import { RouterModule } from '@angular/router';

@NgModule({
  //...
  imports: [
    CommonModule, //for ngif 相關 common
    RouterModule, // for route path 使用
    ReactiveFormsModule, // for formGroup 使用
  ],
  //...
}
```

## AppRoutingModule 拆分至 RecipesRouteModule
appRoutes 也可以將路由參數進行拆分，如之前介紹過的 Route path 參數可以直接寫在 appModule 透過 RouterModule.forRoot() 完成。我們也可以寫在 RecipesModule 透過 RouterModule.forChild() 來完成。但這裡也是為了簡潔（當時為是另寫 AppRoutingModule 再 import 給 AppModule )，這裡將規劃一個 RecipesRouteModule 提供 import 給 RecipesModule。

- 手動或 cli 指令建立`src\app\recipes\recipes-routing.module.ts`為 RecipesRoutingModule
- 將 AppRoutingModule 與 Recipe 有關的路由都搬移到 RecipesRoutingModule
- 參考兩者寫法，在RecipesRoutingModule內需要使用RouterModule.forChild並exports供其他模組使用。
- 於RecipesModule相同方式，import此RecipesRoutingModule

```typescript src\app\app-routing.module.ts
// ...
// import { AuthGuard } from './auth/auth-guard.service';
// import { RecipesComponent } from './recipes/recipes.component';
// import { RecipeStartComponent } from './recipes/recipe-start/recipe-start.component';
// import { RecipeDetailComponent } from './recipes/recipe-detail/recipe-detail.component';
// import { RecipeEditComponent } from './recipes/recipe-edit/recipe-edit.component';
// import { RecipesResolverService } from './recipes/recipes-resolver.service';

const appRoutes: Routes = [
  { path: '', redirectTo: '/recipes', pathMatch: 'full' },
  // {
  //   path: 'recipes',
  //   component: RecipesComponent,
  //   canActivate: [AuthGuard],
  //   children: [
  //     { path: '', component: RecipeStartComponent },
  //     { path: 'new', component: RecipeEditComponent },
  //     {
  //       path: ':id',
  //       component: RecipeDetailComponent,
  //       resolve: [RecipesResolverService]
  //     },
  //     {
  //       path: ':id/edit',
  //       component: RecipeEditComponent,
  //       resolve: [RecipesResolverService]
  //     }
  //   ]
  // },
  { path: 'shopping-list', component: ShoppingListComponent },
  { path: 'auth', component: AuthComponent }
];

@NgModule({
  imports: [RouterModule.forRoot(appRoutes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }
```
```typescript src\app\recipes\recipes-routing.module.ts
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterModule, Routes } from '@angular/router';

import { AuthGuard } from '../auth/auth-guard.service';
import { RecipesComponent } from './recipes.component';
import { RecipeStartComponent } from './recipe-start/recipe-start.component';
import { RecipeDetailComponent } from './recipe-detail/recipe-detail.component';
import { RecipeEditComponent } from './recipe-edit/recipe-edit.component';
import { RecipesResolverService } from './recipes-resolver.service';


const recipesRoutes: Routes = [
  {
    path: 'recipes',
    component: RecipesComponent,
    canActivate: [AuthGuard],
    children: [
      { path: '', component: RecipeStartComponent },
      { path: 'new', component: RecipeEditComponent },
      {
        path: ':id',
        component: RecipeDetailComponent,
        resolve: [RecipesResolverService]
      },
      {
        path: ':id/edit',
        component: RecipeEditComponent,
        resolve: [RecipesResolverService]
      }
    ]
  },
]
  ;

@NgModule({
  imports: [RouterModule.forChild(recipesRoutes)],
  exports: [RouterModule]
})
export class RecipesRoutingModule { }
```
```typescript src\app\recipes\recipes.module.ts
//...
import { RecipesRoutingModule } from './recipes-routing.module'; // ※重點

@NgModule({
  // ...
  imports: [
    CommonModule, 
    RouterModule, 
    ReactiveFormsModule, 
    RecipesRoutingModule // ※重點
  ],
  //...
})
export class RecipesModule { }
```

--- 
# 參考文獻
- [Udemy Angular - The Complete Guide (2023 Edition)](https://www.udemy.com/course/the-complete-guide-to-angular-2/) SESSION 22, 23, 24